(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Database = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";function Database(e,t){if(t=t||{},this.dbname=e,this.syncURL=t.syncURL||"http://kwantu10.kwantu.net:8000/kwantu_apps",this.username=t.username||"",this.password=t.password||"",this.mock=t.mock||!1,this.adapter="pouchdb",this.url="http://localhost:59840",this.db={},this.authenticated=!1,this._settings={_id:"_local/settings",lastSynSeq:0,session:{},subscriptions:{}},this.createDB=function(){window.cblite?(this.adapter="couchbase",window.cblite.getURL(function(e,t){if(e)throw"Couchbase Lite Initilization error - "+JSON.stringify(e);this.url=t;try{var n=new XMLHttpRequest;n.open("GET",this.url,!1),n.send(null)}catch(e){throw"Android version 4.1 error - "+JSON.stringify(e)}var a={url:this.url+"/"+this.dbname,type:"PUT",data:"",dataType:"JSON",contentType:"application/json"},r=$.ajax(a);r.done(function(e,t,n){console.log(n.responseText)}).fail(function(e,t,n){console.log(e.responseText)})})):(this.adapter="pouchdb",console.warn("Couchbase Lite plugin not found. Creating the PouchDB database."),this.mock===!0?this.db=new PouchDB(this.dbname,{adapter:"memory"}):this.db=new PouchDB(this.dbname))},void 0===e)throw"DBERROR: A database name is required i.e. var db = new Database('default');";this.createDB()}Database.prototype.deleteDB=function(){var e=this;return new Promise(function(t,n){if("couchbase"===e.adapter){var a={url:e.url+"/"+e.dbname,type:"DELETE"};$.ajax(a).done(function(e,n,a){t(e)}).fail(function(e,t,a){console.log("Native - error deleting database. Error stacktrace: "+JSON.stringify(e)),n(e.responseText)})}else e.db.destroy().then(function(e){t(e)}).catch(function(e){console.log("Browser - error deleting database. Error stacktrace: "+e),n(e)})})},Database.prototype.save=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/"+e._id+"?rev="+e._rev,type:"PUT",data:JSON.stringify(e),contentType:"application/json",dataType:"json"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.log("Native - error saving document with id: "+e._id+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.db.put(e).then(function(e){n(e)}).catch(function(t){console.log("Browser - error saving document with id: "+e._id+". Error stacktrace: "+t),a(t)})})},Database.prototype.get=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/"+e,type:"GET",dataType:"json"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.log("Native - error getting document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.db.get(e).then(function(e){n(e)}).catch(function(t){console.log("Browser - error getting document with id: "+e+". Error stacktrace: "+t),a(t)})})},Database.prototype.remove=function(e,t){var n=this;return new Promise(function(a,r){if("couchbase"===n.adapter){var o={url:n.url+"/"+n.dbname+"/"+e+"?rev="+t,type:"DELETE",Accept:"application/json",dataType:"json"};$.ajax(o).done(function(e,t,n){a(e)}).fail(function(t,n,a){console.log("Native - error deleting document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),r(t.responseText)})}else n.db.remove(e,t).then(function(e){a(e)}).catch(function(t){console.log("Browser - error deleting document with id: "+e+". Error stacktrace: "+t),r(t)})})},Database.prototype.saveAttachment=function(e,t,n,a,r){var o=this;return new Promise(function(i,s){if("couchbase"===o.adapter){var c={url:o.url+"/"+o.dbname+"/"+e+"/"+r+"?rev="+t,type:"PUT",data:n,dataType:"json",contentType:a};$.ajax(c).done(function(e,t,n){i(e)}).fail(function(t,n,a){console.log("Native - error saving attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),s(t.responseText)})}else o.db.putAttachment(e,r,t,n,a).then(function(e){i(e)}).catch(function(t){console.log("Browser - error saving attachment for the document with id: "+e+". Error stacktrace: "+t),s(t)})})},Database.prototype.getAttachment=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={url:a.url+"/"+a.dbname+"/"+e+"/"+n+"?rev="+t,type:"GET"};$.ajax(i).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error retrieving attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else a.db.getAttachment(e,n,{rev:t}).then(function(e){r(e)}).catch(function(t){console.warn("Browser - error retrieving attachment for the document with id: "+e+". Error stacktrace: "+t),o(t)})})},Database.prototype.deleteAttachment=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={url:a.url+"/"+a.dbname+"/"+e+"/"+n+"?rev="+t,type:"DELETE",dataType:"json"};$.ajax(i).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error deleting attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else a.db.removeAttachment(e,n,t).then(function(e){r(e)}).catch(function(t){console.warn("ERRCODE: "+t.status+" ( "+t.name+" ) - Error deleting attachment for the document with id: "+e+". "+t.message+"."),o(t)})})},Database.prototype.createDocView=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={language:"javascript",views:{}},s="function(doc) { "+n.toString()+" }";i.views[t]={map:s};var c={url:a.url+"/"+a.dbname+"/_design/"+e,type:"PUT",data:i,dataType:"json",contentType:"application/json"};$.ajax(c).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error creating the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else{var i={_id:"_design/"+e,views:{}},s="function(doc) { "+n.toString()+" }";i.views[t]={map:s},a.save(i).then(function(e){r(e)},function(t){409!==t.status?(console.warn("Browser - error creating the design document with the id: "+e+". Error stacktrace: "+t),o(t)):(console.warn(t),r({}))})}})},Database.prototype.getDocView=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/_design/"+e,type:"GET"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.warn("Native - error getting the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.get("_design/"+e).then(function(e){n(e)},function(t){console.warn("Browser - error getting the design document with the id: "+e+". Error stacktrace: "+t),a(t)})})},Database.prototype.deleteDocView=function(e,t){var n=this;return new Promise(function(a,r){if("couchbase"===n.adapter){var o={url:n.url+"/"+n.dbname+"/_design/"+e+"?rev="+t,type:"DELETE"};$.ajax(o).done(function(e,t,n){a(e)}).fail(function(t,n,a){console.warn("Native - error deleting the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),r(t.responseText)})}else n.remove("_design/"+e,t).then(function(e){a(e)},function(t){console.warn("Browser - error deleting the design document with the id: "+e+". Error stacktrace: "+t),r(t)})})},Database.prototype.query=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i="include_docs=true&key="+n.key,s={url:a.url+"/"+a.dbname+"/_design/"+e+"/_view/"+t+"?"+i,type:"GET",dataType:"json"};$.ajax(s).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error querying the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else{var c=n.pageSize||100,u=n.pageIndex||0,s={key:n.key,limit:c,skip:u*c,include_docs:!0};a.db.query(e+"/"+t,s).then(function(e){r(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - querying the design document with the id: "+id+". "+e.message+"."),o(e)})}})},Database.prototype.authenticateToSyncGateway=function(){var e=this;return new Promise(function(t,n){var a=e.syncURL+"/_session",r="POST",o=JSON.stringify({name:e.username,password:e.password}),i=!0,s=new XMLHttpRequest;s.withCredentials=!0,s.onload=function(){var a=s.status,r=s.responseText;200==a?(e.authenticated=!0,t(r)):n(r)},s.open(r,a,i),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(o)})},Database.prototype.changes=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r="limit=100&since="+t._settings.lastSyncSeq,o={url:t.url+"/"+t.dbname+"/_changes?"+r,type:"GET",dataType:"json"};$.ajax(o).done(function(e,t,a){n(e)}).fail(function(e,t,n){console.warn("Native - error retrieving the latest changes. Error stacktrace: "+JSON.stringify(e)),a(e.responseText)})}else{var r={limit:100,since:t._settings.lastSyncSeq},o=e||r;t.db.changes(o).then(function(e){n(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - retrieving the latest changes: "+id+". "+e.message+"."),a(e)})}})},Database.prototype.startPull=function(){var e=this;return new Promise(function(t,n){"couchbase"===e.adapter?cordova.exec(function(e){t(e)},function(e){n(e)},"CBLite","pull",[{dbname:e.dbname,url:e.syncURL}]):e.db.replicate.from(new PouchDB(e.syncURL)).then(function(e){t(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - retrieving the latest changes: "+id+". "+e.message+"."),n(e)})})},Database.prototype.startSync=function(){var e=this,t=e._settings.subscriptions.username,n=e._settings.subscriptions.password;return new Promise(function(a,r){"couchbase"===e.adapter?cordova.exec(function(t){e._settings.lastSyncSeq===t&&(e._settings.lastSyncSeq=t,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))},function(e){r(e)},"CBLite","sync",[{dbname:e.dbname,url:"http://"+t+":"+n+"@"+e.syncURL.replace("http://","")}]):e.authenticated===!1?e.authenticateToSyncGateway(t,n).then(function(t){e.db.sync(new PouchDB(e.syncURL),{live:!0,retry:!0}).on("change",function(t){var n=t.last_seq;e._settings.lastSyncSeq!==n&&(e._settings.lastSyncSeq=n,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))}).on("error",function(e){r(e)})},function(e){r(e)}):e.db.sync(new PouchDB(e.syncURL),{live:!0,retry:!0}).on("change",function(t){var n=t.last_seq;e._settings.lastSyncSeq!==n&&(e._settings.lastSyncSeq=n,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))}).on("error",function(e){r(e)})})},module.exports=Database;

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FDQUEsWUE4QkEsU0FBUyxVQUFTLEVBQVEsR0EySHpCLEdBekhBLEVBQVUsTUFPVixLQUFLLE9BQVMsRUFRZCxLQUFLLFFBQVUsRUFBUSxTQUFXLDhDQU9sQyxLQUFLLFNBQVcsRUFBUSxVQUFZLEdBT3BDLEtBQUssU0FBVyxFQUFRLFVBQVksR0FRcEMsS0FBSyxLQUFPLEVBQVEsT0FBUSxFQVM1QixLQUFLLFFBQVUsVUFTZixLQUFLLElBQU0seUJBUVgsS0FBSyxNQUNMLEtBQUssZUFBZ0IsRUFDckIsS0FBSyxXQUNKLElBQUksa0JBQ0osV0FBWSxFQUNaLFdBQ0Esa0JBR0QsS0FBSyxTQUFXLFdBRVgsT0FBTyxRQUVWLEtBQUssUUFBVSxZQUVmLE9BQU8sT0FBTyxPQUFPLFNBQVMsRUFBSyxHQUNsQyxHQUFJLEVBRUgsS0FBTSx3Q0FBMEMsS0FBSyxVQUFVLEVBRS9ELE1BQUssSUFBTSxDQUVYLEtBQ0MsR0FBSSxHQUFVLEdBQUksZUFDbEIsR0FBUSxLQUFLLE1BQU8sS0FBSyxLQUFLLEdBQzlCLEVBQVEsS0FBSyxNQUNaLE1BQU0sR0FDUCxLQUFNLCtCQUFpQyxLQUFLLFVBQVUsR0FHdkQsR0FBSSxJQUNILElBQUssS0FBSyxJQUFNLElBQU0sS0FBSyxPQUMzQixLQUFNLE1BQ04sS0FBTSxHQUNOLFNBQVUsT0FDVixZQUFhLG9CQUVWLEVBQVEsRUFBRSxLQUFLLEVBQ25CLEdBQU0sS0FBSyxTQUFTLEVBQU0sRUFBWSxHQUNyQyxRQUFRLElBQUksRUFBTSxnQkFDaEIsS0FBSyxTQUFTLEVBQU8sRUFBWSxHQUNuQyxRQUFRLElBQUksRUFBTSxvQkFNckIsS0FBSyxRQUFVLFVBRWYsUUFBUSxLQUFLLG1FQUNULEtBQUssUUFB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QUFTLEdBQ3ZDLEVBQVEsSUFDTixTQUFTLEdBQy9CLEVBQU8sUUFJTSxHQUFHLFFBQVMsU0FBUyxHQUNyQixFQUFPLE1BRXJCLFNBQVMsR0FDWCxFQUFPLEtBR1IsRUFBSyxHQUFHLEtBQUssR0FBSSxTQUFRLEVBQUssVUFBWSxNQUFNLEVBQU0sT0FBTyxJQUM1RCxHQUFHLFNBQVUsU0FBUyxHQUNQLEdBQUksR0FBTSxFQUFLLFFBQ1osR0FBSyxVQUFVLGNBQWdCLElBQ2hDLEVBQUssVUFBVSxZQUFjLEVBQzVCLEVBQUssS0FBSyxFQUFLLFdBQVcsS0FBSyxTQUFTLEdBQ3ZDLEVBQVEsSUFDTixTQUFTLEdBQzVCLEVBQU8sUUFJRyxHQUFHLFFBQVMsU0FBUyxHQUNyQixFQUFPLFFBT3hCLE9BQU8sUUFBVSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIndXNlIHN0cmljdCc7XG5cbi8qZ2xvYmFscyBKU09OLCBQb3VjaERCLCBQcm9taXNlIGNvcmRvdmEqL1xuXG4vKipcbiAqIFJlcHJlc2VudHMgdGhlIGdlbmVyaWMgRGF0YWJhc2UgKCBEYXRhYmFzZSBBY2Nlc3MgT2JqZWN0ICkuIFRoaXMgaXMgYSB3cmFwcGVyIG1vZHVsZVxuICogdXNlZCB0byBpbnRlcmZhY2Ugd2l0aCBlaXRoZXIgdGhlIENvdWNoYmFzZSBMaXRlIG9yIFBvdWNoREIgZGF0YWJhc2VzLlxuICpcbiAqIEBjbGFzc1xuICogQHBhcmFtIHtzdHJpbmd9IGRibmFtZSAtIERhdGFiYXNlIG5hbWVcbiAqIEBwYXJhbSB7T2JqZWN0fSBbb3B0aW9uc11cbiAqIFx0QHBhcmFtIHtzdHJpbmd9IG9wdGlvbnMuc3luY1VSTFxuICpcdFN5bmMgZ2F0ZXdheSBVUkxcbiAqXHRAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy51c2VybmFtZVxuICpcdExvZ2dlZCBpbiB1c2VyJ3MgdXNlcm5hbWVcbiAqXHRAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5wYXNzd29yZFxuICpcdExvZ2dlZCBpbiB1c2VyJ3MgcGFzc3dvcmRcbiAqXHRAcGFyYW0ge2Jvb2xlYW59IG9wdGlvbnMubW9ja1xuICpcdFRydWUgLyBmYWxzZSB2YWx1ZSB1c2VkIGZvciBtb2NrIHRlc3RpbmdcbiAqIEBhdXRob3IgU2F0aW5kZXIgU2luZ2gsIEJyZW50IEdvcmRvblxuICogQHZlcnNpb24gMS4wLjBcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGRiID0gbmV3IERhdGFiYXNlKCdkYm5hbWUnKTtcbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IG5ldyBEYXRhYmFzZSBjb25zdHJ1Y3RvciAvIGNsYXNzIG9iamVjdFxuICpcbiAqIEB0aHJvd3MgXCJEQkVSUk9SOiBBIGRhdGFiYXNlIG5hbWUgaXMgcmVxdWlyZWQgaS5lLiB2YXIgZGFvID0gbmV3IERhdGFiYXNlKCdkZWZhdWx0Jyk7XCJcbiAqXG4gKi9cbmZ1bmN0aW9uIERhdGFiYXNlKGRibmFtZSwgb3B0aW9ucyl7XG5cdC8vIG9wdGlvbnMgaXMgYW4gb3B0aW9uYWwgcGFyYW1ldGVyXG5cdG9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXHQvKipcblx0ICogVGhlIGRhdGFiYXNlIG5hbWUuXG5cdCAqXG5cdCAqIEBuYW1lIERhdGFiYXNlI2RibmFtZVxuXHQgKiBAdHlwZSBTdHJpbmdcblx0ICovXG5cdHRoaXMuZGJuYW1lID0gZGJuYW1lO1xuXHQvKipcblx0ICogVGhlIENvdWNoYmFzZSBTeW5jIEdhdGV3YXkgVVJMLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSNzeW5jVVJMXG5cdCAqIEB0eXBlIFN0cmluZ1xuXHQgKiBAZGVmYXVsdCBcImh0dHA6Ly9rd2FudHUxMC5rd2FudHUubmV0OjgwMDAva3dhbnR1X2FwcHNcIlxuXHQgKi9cblx0dGhpcy5zeW5jVVJMID0gb3B0aW9ucy5zeW5jVVJMIHx8ICdodHRwOi8va3dhbnR1MTAua3dhbnR1Lm5ldDo4MDAwL2t3YW50dV9hcHBzJztcblx0LyoqXG5cdCAqIFRoZSBDb3VjaGJhc2UgU3luYyBHYXRld2F5IHVzZXIncyB1c2VybmFtZS5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjdXNlcm5hbWVcblx0ICogQHR5cGUgU3RyaW5nXG5cdCAqL1xuXHR0aGlzLnVzZXJuYW1lID0gb3B0aW9ucy51c2VybmFtZSB8fCAnJztcblx0LyoqXG5cdCAqIFRoZSBDb3VjaGJhc2UgU3luYyBHYXRld2F5IHVzZXIncyBwYXNzd29yZC5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjcGFzc3dvcmRcblx0ICogQHR5cGUgU3RyaW5nXG5cdCAqL1xuXHR0aGlzLnBhc3N3b3JkID0gb3B0aW9ucy5wYXNzd29yZCB8fCAnJztcblx0LyoqXG5cdCAqIFRoZSBtb2NrIGRhdGFiYXNlIGZsYWcuXG5cdCAqXG5cdCAqIEBuYW1lIERhdGFiYXNlI21vY2tcblx0ICogQHR5cGUgQm9vbGVhblxuXHQgKiBAZGVmYXVsdCBmYWxzZVxuXHQgKi9cblx0dGhpcy5tb2NrID0gb3B0aW9ucy5tb2NrIHx8IGZhbHNlO1xuXHQvKipcblx0ICogVGhlIGRhdGFiYXNlIGFkYXB0ZXIgdHlwZS5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjYWRhcHRlclxuXHQgKiBAdHlwZSBTdHJpbmdcblx0ICogQGRlZmF1bHQgXCJwb3VjaGRiXCJcblx0ICogQHJlYWRvbmx5XG5cdCAqL1xuXHR0aGlzLmFkYXB0ZXIgPSAncG91Y2hkYic7XG5cdC8qKlxuXHQgKiBUaGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2UgVVJMLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSN1cmxcblx0ICogQHR5cGUgU3RyaW5nXG5cdCAqIEBkZWZhdWx0IFwiaHR0cDovL2xvY2FsaG9zdDo1OTg0MFwiXG5cdCAqIEByZWFkb25seVxuXHQgKi9cblx0dGhpcy51cmwgPSAnaHR0cDovL2xvY2FsaG9zdDo1OTg0MCc7XG5cdC8qKlxuXHQgKiBUaGUgUG91Y2hEQiBkYXRhYmFzZSBjb25zdHJ1Y3RvciBjbGFzcy5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjZGJcblx0ICogQHR5cGUgT2JqZWN0XG5cdCAqIEByZWFkb25seVxuXHQgKi9cblx0dGhpcy5kYiA9IHt9O1xuXHR0aGlzLmF1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcblx0dGhpcy5fc2V0dGluZ3MgPSB7XG5cdFx0X2lkOidfbG9jYWwvc2V0dGluZ3MnLFxuXHRcdGxhc3RTeW5TZXE6IDAsXG5cdFx0c2Vzc2lvbjoge30sXG5cdFx0c3Vic2NyaXB0aW9uczoge31cblx0fTtcblx0Ly8gSW5pdGlhbGlzZSBmdW5jdGlvbiwgdXNlZCB0byBjcmVhdGUgdGhlIGRhdGFiYXNlXG5cdHRoaXMuY3JlYXRlREIgPSBmdW5jdGlvbigpe1xuXHRcdC8vIERldGVybWluZSBpZiB0aGlzIGlzIGEgbmF0aXZlIGRldmljZSBpLmUuIGlzIENvdWNoYmFzZSBMaXRlIGluc3RhbGxlZFxuXHRcdGlmICh3aW5kb3cuY2JsaXRlKXtcblx0XHRcdC8vIFNldCB0aGUgYWRhcHRlciB0eXBlXG5cdFx0XHR0aGlzLmFkYXB0ZXIgPSAnY291Y2hiYXNlJztcblx0XHRcdC8vIEdldCB0aGUgQ291Y2hiYXNlIExpdGUgbG9jYWwgVVJMXG5cdFx0XHR3aW5kb3cuY2JsaXRlLmdldFVSTChmdW5jdGlvbihlcnIsIHVybCkge1xuXHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0Ly8gTG9nIHRoZSBlcnJvclxuXHRcdFx0XHRcdHRocm93ICdDb3VjaGJhc2UgTGl0ZSBJbml0aWxpemF0aW9uIGVycm9yIC0gJyArIEpTT04uc3RyaW5naWZ5KGVycik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy51cmwgPSB1cmw7XG5cdFx0XHRcdFx0Ly8gQ2hlY2sgZm9yIGFuZHJvaWQgdmVyc2lvbiA0LjEgYnVnXG5cdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdHZhciB4bWxIdHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdFx0XHRcdFx0XHR4bWxIdHRwLm9wZW4oJ0dFVCcsIHRoaXMudXJsLCBmYWxzZSk7XG5cdFx0XHRcdFx0XHR4bWxIdHRwLnNlbmQobnVsbCk7XG5cdFx0XHRcdFx0fSBjYXRjaChlcnIpIHtcblx0XHRcdFx0XHRcdHRocm93ICdBbmRyb2lkIHZlcnNpb24gNC4xIGVycm9yIC0gJyArIEpTT04uc3RyaW5naWZ5KGVycik7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vIENyZWF0ZSB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0XHRcdHVybDogdGhpcy51cmwgKyAnLycgKyB0aGlzLmRibmFtZSxcblx0XHRcdFx0XHRcdHR5cGU6ICdQVVQnLFxuXHRcdFx0XHRcdFx0ZGF0YTogJycsXG5cdFx0XHRcdFx0XHRkYXRhVHlwZTogJ0pTT04nLFxuXHRcdFx0XHRcdFx0Y29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xuXHRcdFx0XHRcdH07XG5cdFx0XHRcdFx0dmFyIGpxeGhyID0gJC5hamF4KG9wdGlvbnMpO1xuXHRcdFx0XHRcdGpxeGhyLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGpxWEhSLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHRcdFx0fSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKGpxWEhSLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBTZXQgdGhlIGFkYXB0ZXIgdHlwZVxuXHRcdFx0dGhpcy5hZGFwdGVyID0gJ3BvdWNoZGInO1xuXHRcdFx0Ly8gQ3JlYXRlIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRjb25zb2xlLndhcm4oJ0NvdWNoYmFzZSBMaXRlIHBsdWdpbiBub3QgZm91bmQuIENyZWF0aW5nIHRoZSBQb3VjaERCIGRhdGFiYXNlLicpO1xuXHRcdFx0aWYgKHRoaXMubW9jayA9PT0gdHJ1ZSkge1xuXHRcdFx0XHR0aGlzLmRiID0gbmV3IFBvdWNoREIodGhpcy5kYm5hbWUsIHsgYWRhcHRlcjogJ21lbW9yeScgfSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmRiID0gbmV3IFBvdWNoREIodGhpcy5kYm5hbWUpO1xuXHRcdFx0fVxuXHRcdH1cblx0fTtcblx0Ly8gQ3JlYXRlIHRoZSBkYXRhYmFzZVxuXHRpZiAoZGJuYW1lID09PSB1bmRlZmluZWQpe1xuXHRcdHRocm93ICdEQkVSUk9SOiBBIGRhdGFiYXNlIG5hbWUgaXMgcmVxdWlyZWQgaS5lLiB2YXIgZGIgPSBuZXcgRGF0YWJhc2UoXFwnZGVmYXVsdFxcJyk7Jztcblx0fSBlbHNlIHtcblx0XHR0aGlzLmNyZWF0ZURCKCk7XG5cdH1cbn1cblxuLyoqXG4gKiBEZWxldGUgdGhlIGRhdGFiYXNlIGluY2x1ZGluZyBhbGwgZG9jdW1lbnRzIGFuZCBhdHRhY2htZW50cy4gTm90ZSB0aGF0IHRoaXMgaGFzIG5vIGltcGFjdFxuICogb24gb3RoZXIgcmVwbGljYXRlZCBkYXRhYmFzZXMuXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIENhbGwgdGhlIGRlbGV0ZSBkYXRhYmFzZSBmdW5jdGlvblxuICogZGFvLmRlbGV0ZURCKCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSwgZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgXCJva1wiOiB0cnVlIH1cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IFJldHVybnMgdGhlIHN0YW5kYXJkIHsgXCJva1wiIDogdHJ1ZSB9IG1lc3NhZ2Ugb2JqZWN0LlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmRlbGV0ZURCID0gZnVuY3Rpb24oKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBEZWxldGUgdGhlIGRhdGFiYXNlIGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIERlbGV0ZSB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUsXG5cdCAgICAgICAgICAgIHR5cGU6ICdERUxFVEUnXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdOYXRpdmUgLSBlcnJvciBkZWxldGluZyBkYXRhYmFzZS4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gRGVsZXRlIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLmRiLmRlc3Ryb3koKS50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbiAoZXJyKSB7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdCcm93c2VyIC0gZXJyb3IgZGVsZXRpbmcgZGF0YWJhc2UuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBlcnIpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIENyZWF0ZSBhIG5ldyBkb2N1bWVudCBvciB1cGRhdGUgYW4gZXhpc3RpbmcgZG9jdW1lbnQuIElmIHRoZSBkb2N1bWVudCBhbHJlYWR5IGV4aXN0cyxcbiAqIHlvdSBtdXN0IHNwZWNpZnkgaXRzIHJldmlzaW9uIF9yZXYsIG90aGVyd2lzZSBhIGNvbmZsaWN0IHdpbGwgb2NjdXIuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGRvYyAtIFRoZSBKU09OIGRvY3VtZW50XG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRlc3QgZG9jdW1lbnRcbiAqIHZhciBkb2MgPSB7IFwiX2lkXCI6IFwiMTIzNDVcIiwgXCJ0aXRsZVwiOiBcIlRlc3QgZG9jdW1lbnQuXCIgfTtcbiAqIGRhby5zYXZlKGRvYykudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSxmdW5jdGlvbihlcnJvcil7XG4gKiAgY29uc29sZS5sb2coZXJyb3IpO1xuICogfSk7XG4gKiAvLyBFeGFtcGxlIHJldHVyblxuICogeyBcIm9rXCI6IHRydWUsIFwiaWRcIjogXCIxMjM0NVwiLCBcInJldlwiOiBcIjEtQTYxNTdBNUVBNTQ1Qzk5QjAwRkY5MDRFRUYwNUZEOUZcIiB9XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzcG9uc2UgY29udGFpbnMgdGhlIGlkIG9mIHRoZSBkb2N1bWVudCwgdGhlIG5ldyByZXYsIGFuZCBhbiBva1xuICogdG8gcmVhc3N1cmUgeW91IHRoYXQgZXZlcnl0aGluZyBpcyBva2F5LlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLnNhdmUgPSBmdW5jdGlvbihkb2Mpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEdldCB0aGUgZG9jdW1lbnQgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gU2F2ZSB0aGUgZG9jdW1lbnQgaW4gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy8nICsgZG9jLl9pZCArICc/cmV2PScgKyBkb2MuX3Jldixcblx0ICAgICAgICAgICAgdHlwZTogJ1BVVCcsXG5cdCAgICAgICAgICAgIGRhdGE6IEpTT04uc3RyaW5naWZ5KGRvYyksXG5cdCAgICAgICAgICAgIGNvbnRlbnRUeXBlOiAnYXBwbGljYXRpb24vanNvbicsXG5cdCAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS5sb2coJ05hdGl2ZSAtIGVycm9yIHNhdmluZyBkb2N1bWVudCB3aXRoIGlkOiAnICsgZG9jLl9pZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIENyZWF0ZSAvIHVwZGF0ZSB0aGUgZG9jdW1lbnQgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIucHV0KGRvYykudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdCcm93c2VyIC0gZXJyb3Igc2F2aW5nIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBkb2MuX2lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogUmV0cmlldmVzIGEgZG9jdW1lbnQsIHNwZWNpZmllZCBieSBkb2N1bWVudCBpZC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBEb2N1bWVudCB1dWlkICgga2V5IClcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gQ2FsbGluZyB0aGUgZ2V0IG1ldGhvZFxuICogZGFvLmdldCgnMTIzNCcpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgXCJfaWRcIjogXCIxMjM0NVwiLCBcIl9yZXZcIjogXCIxLUE2MTU3QTVFQTU0NUM5OUIwMEZGOTA0RUVGMDVGRDlGXCIsIFwidGl0bGVcIjogXCJUZXN0IGRvY3VtZW50LlwiIH1cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IFRoZSByZXNwb25zZSBjb250YWlucyB0aGUgZG9jdW1lbnQgYXMgaXQgaXMgc3RvcmVkIGluIHRoZSBkYXRhYmFzZSwgYWxvbmdcbiAqIHdpdGggaXRzIF9pZCBhbmQgX3Jldi5cbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5nZXQgPSBmdW5jdGlvbihpZCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gR2V0IHRoZSBkb2N1bWVudCBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBHZXQgdGhlIGRvY3VtZW50IGZyb20gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy8nICsgaWQsXG5cdCAgICAgICAgICAgIHR5cGU6ICdHRVQnLFxuXHQgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdOYXRpdmUgLSBlcnJvciBnZXR0aW5nIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0c2VsZi5kYi5nZXQoaWQpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQnJvd3NlciAtIGVycm9yIGdldHRpbmcgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogRGVsZXRlcyB0aGUgZG9jdW1lbnQuIFRoZSBpZCBhbmQgcmV2IHBhcmFtZXRlcnMgYXJlIGJvdGggcmVxdWlyZWQuIFdoZW4gYSBkb2N1bWVudCBpcyBkZWxldGVkLFxuICogdGhlIHJldmlzaW9uIG51bWJlciBpcyB1cGRhdGVkIHNvIHRoZSBkYXRhYmFzZSBjYW4gdHJhY2sgdGhlIGRlbGV0aW9uIGluIHN5bmNocm9uaXplZCBjb3BpZXMuXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IGlkIC0gRG9jdW1lbnQgdXVpZCAoIGtleSApXG4gKiBAcGFyYW0ge09iamVjdH0gcmV2IC0gRG9jdW1lbnQgcmV2aXNpb24gbnVtYmVyXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRlc3QgaWQgYW5kIHJldiB2YXJpYWJsZXNcbiAqIHZhciBpZCA9IFwiMTIzNDVcIjtcbiAqIHZhciByZXYgPSBcIjEtQTYxNTdBNUVBNTQ1Qzk5QjAwRkY5MDRFRUYwNUZEOUZcIjtcbiAqIGRhby5yZW1vdmUoaWQsIHJldikudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSxmdW5jdGlvbihlcnJvcil7XG4gKiAgY29uc29sZS5sb2coZXJyb3IpO1xuICogfSk7XG4gKiAvLyBFeGFtcGxlIHJldHVyblxuICogeyBcIm9rXCI6IHRydWUsIFwiaWRcIjogXCIxMjM0NVwiLCBcInJldlwiOiBcIjEtQTYxNTdBNUVBNTQ1Qzk5QjAwRkY5MDRFRUYwNUZEOUZcIiB9XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzcG9uc2UgaXMgYSBKU09OIGRvY3VtZW50IHRoYXQgY29udGFpbnMgdGhlIG9rLCBpZCBhbmQgcmV2IHByb3BlcnRpZXMuXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUucmVtb3ZlID0gZnVuY3Rpb24oaWQsIHJldil7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gRGVsZXRlIHRoZSBkb2N1bWVudCBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIGRvY3VtZW50IGZyb20gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy8nICsgaWQgKyAnP3Jldj0nICsgcmV2LFxuXHQgICAgICAgICAgICB0eXBlOiAnREVMRVRFJyxcblx0ICAgICAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsXG5cdCAgICAgICAgICAgIGRhdGFUeXBlOiAnanNvbidcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS5sb2coJ05hdGl2ZSAtIGVycm9yIGRlbGV0aW5nIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0c2VsZi5kYi5yZW1vdmUoaWQsIHJldikudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdCcm93c2VyIC0gZXJyb3IgZGVsZXRpbmcgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogQXR0YWNoZXMgYSBiaW5hcnkgb2JqZWN0IHRvIGEgZG9jdW1lbnQuIFRoaXMgbWV0aG9kIHdpbGwgdXBkYXRlIGFuIGV4aXN0aW5nIGRvY3VtZW50IHRvIGFkZFxuICogdGhlIGF0dGFjaG1lbnQsIHNvIGl0IHJlcXVpcmVzIGEgcmV2IGlmIHRoZSBkb2N1bWVudCBhbHJlYWR5IGV4aXN0cy4gSWYgdGhlIGRvY3VtZW50IGRvZXNu4oCZdFxuICogYWxyZWFkeSBleGlzdCwgdGhlbiB0aGlzIG1ldGhvZCB3aWxsIGNyZWF0ZSBhbiBlbXB0eSBkb2N1bWVudCBjb250YWluaW5nIHRoZSBhdHRhY2htZW50LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIERvY3VtZW50IHV1aWQgKCBrZXkgKVxuICogQHBhcmFtIHtzdHJpbmd9IHJldiAtIERvY3VtZW50IHJldmlzaW9uIG51bWJlclxuICogQHBhcmFtIHtiaW5hcnl9IGF0dGFjaGVtbnQgLSBBdHRhY2htZW50IGRpbmFyeSBkb2N1bWVudFxuICogQHBhcmFtIHtzdHJpbmd9IHR5cGUgLSBUaGUgYXR0YWNobWVudCBtaW1lIHR5cGVcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRhY2hlbW50SWQgLSBBdHRhY2htZW50IGlkIGkuZS4gbmFtZSBvZiB0aGUgZmlsZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUZXN0IHZhcmlhYmxlc1xuICogdmFyIGlkID0gXCIxMjM0NVwiO1xuICogdmFyIHJldiA9IFwiMS1BNjE1N0E1RUE1NDVDOTlCMDBGRjkwNEVFRjA1RkQ5RlwiO1xuICogdmFyIGF0dGFjaG1lbnRJZCA9ICdmaWxlLnR4dCc7XG4gKiB2YXIgdHlwZSA9ICd0ZXh0L3BsYWluJztcbiAqIHZhciBhdHRhY2htZW50ID0gbmV3IEJsb2IoWydUaGlzIGlzIGEgcGxhaW4gdGV4dCBhdHRhY2hlbWVudC4nXSwge3R5cGU6IHR5cGV9KTtcbiAqIC8vIENhbGwgdGhlIHNhdmVBdHRhY2htZW50IG1ldGhvZFxuICogZGFvLnNhdmVBdHRhY2htZW50KGlkLCByZXYsIGF0dGFjaG1lbnQsIHR5cGUsIGF0dGFjaG1lbnRJZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSxmdW5jdGlvbihlcnJvcil7XG4gKiAgY29uc29sZS5sb2coZXJyb3IpO1xuICogfSk7XG4gKiAvLyBFeGFtcGxlIHJldHVyblxuICogeyBcIm9rXCI6IHRydWUsIFwiaWRcIjogXCIxMjM0NVwiLCBcInJldlwiOiBcIjItMDY4RTczRjVCNDRGRUM5ODdCNTEzNTRERkM3NzI4OTFcIiB9XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzcG9uc2UgY29udGFpbnMgdGhlIGlkIG9mIHRoZSBkb2N1bWVudCwgdGhlIG5ldyByZXYsIGFuZCBhbiBvayB0b1xuICogcmVhc3N1cmUgeW91IHRoYXQgZXZlcnl0aGluZyBpcyBva2F5LlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLnNhdmVBdHRhY2htZW50ID0gZnVuY3Rpb24oaWQsIHJldiwgYXR0YWNoZW1udCwgdHlwZSwgYXR0YWNoZW1udElkKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBTYXZlIHRoZSBhdHRhY2htZW50IHdpdGggdGhlIGRvY3VtZW50IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIFNhdmUgdGhlIGF0dGFjaG1lbnQgd2l0aCB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnLycgKyBpZCArICAnLycgKyBhdHRhY2hlbW50SWQgKyAnP3Jldj0nICsgcmV2LFxuXHRcdFx0XHR0eXBlOiAnUFVUJyxcblx0XHRcdFx0ZGF0YTogIGF0dGFjaGVtbnQsXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbicsXG5cdFx0XHRcdGNvbnRlbnRUeXBlOiB0eXBlXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdOYXRpdmUgLSBlcnJvciBzYXZpbmcgYXR0YWNobWVudCBmb3IgdGhlIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIFNhdmUgdGhlIGF0dGFjaG1lbnQgd2l0aCB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0c2VsZi5kYi5wdXRBdHRhY2htZW50KGlkLCBhdHRhY2hlbW50SWQsIHJldiwgYXR0YWNoZW1udCwgdHlwZSkudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdCcm93c2VyIC0gZXJyb3Igc2F2aW5nIGF0dGFjaG1lbnQgZm9yIHRoZSBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgZXJyKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBHZXQgdGhlIGF0dGFjaG1lbnQgZGF0YSBmcm9tIGEgc3BlY2lmaWMgZG9jdW1lbnQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gRG9jdW1lbnQgdXVpZCAoIGtleSApXG4gKiBAcGFyYW0ge3N0cmluZ30gcmV2IC0gRG9jdW1lbnQgcmV2aXNpb24gbnVtYmVyXG4gKiBAcGFyYW0ge3N0cmluZ30gYXR0YWNoZW1udElkIC0gQXR0YWNobWVudCBpZCBpLmUuIG5hbWUgb2YgdGhlIGZpbGVcbiAqXG4gKiBAdG9kbyBOZWVkIHRvIHVwZGF0ZSB0aGUgd2F5IEJsb2JzIGFyZSBtYW5hZ2VkLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUZXN0IHZhcmlhYmxlc1xuICogdmFyIGlkID0gXCIxMjM0NVwiO1xuICogdmFyIHJldiA9IFwiMS1BNjE1N0E1RUE1NDVDOTlCMDBGRjkwNEVFRjA1RkQ5RlwiO1xuICogdmFyIGF0dGFjaG1lbnRJZCA9ICdmaWxlLnR4dCc7XG4gKiAvLyBDYWxsIHRoZSBzYXZlQXR0YWNobWVudCBtZXRob2RcbiAqIGRhby5nZXRBdHRhY2htZW50KGlkLCByZXYsIGF0dGFjaG1lbnRJZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSxmdW5jdGlvbihlcnJvcil7XG4gKiAgY29uc29sZS5sb2coZXJyb3IpO1xuICogfSk7XG4gKiAvLyBFeGFtcGxlIHJldHVyblxuICogeyBzaXplOiAzMywgdHlwZTogJ3RleHQvcGxhaW4nIH1cbiAqXG4gKiBAcmV0dXJuIHtCbG9ifENvbnRlbnQtVHlwZX0gVGhlIHJlc3BvbnNlIHdpbGwgYmUgYSBCbG9iIG9iamVjdCBpbiB0aGUgYnJvd3NlciBvciBpbiB0aGUgZm9ybWF0XG4gKiBzcGVjaWZpZWQgaW4gdGhlIENvbnRlbnQtVHlwZSBoZWFkZXIuXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuZ2V0QXR0YWNobWVudCA9IGZ1bmN0aW9uKGlkLCByZXYsIGF0dGFjaGVtbnRJZCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gR2V0IHRoZSBhdHRhY2htZW50IGZyb20gdGhlIGRvY3VtZW50IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIEdldCB0aGUgYXR0YWNobWVudCBmcm9tIHRoZSBkb2N1bWVudCBmcm9tIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvJyArIGlkICsgICcvJyArIGF0dGFjaGVtbnRJZCArICc/cmV2PScgKyByZXYsXG5cdFx0XHRcdHR5cGU6ICdHRVQnXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTmF0aXZlIC0gZXJyb3IgcmV0cmlldmluZyBhdHRhY2htZW50IGZvciB0aGUgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gR2V0IHRoZSBhdHRhY2htZW50IGZyb20gdGhlIGRvY3VtZW50IGZyb20gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIuZ2V0QXR0YWNobWVudChpZCwgYXR0YWNoZW1udElkLCB7IHJldjogcmV2IH0pLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ0Jyb3dzZXIgLSBlcnJvciByZXRyaWV2aW5nIGF0dGFjaG1lbnQgZm9yIHRoZSBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgZXJyKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBEZWxldGUgYW4gYXR0YWNobWVudCBmcm9tIGEgZG9jLiBZb3UgbXVzdCBzdXBwbHkgdGhlIHJldiBvZiB0aGUgZXhpc3RpbmcgZG9jLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIERvY3VtZW50IHV1aWQgKCBrZXkgKVxuICogQHBhcmFtIHtzdHJpbmd9IHJldiAtIERvY3VtZW50IHJldmlzaW9uIG51bWJlclxuICogQHBhcmFtIHtzdHJpbmd9IGF0dGFjaGVtbnRJZCAtIEF0dGFjaG1lbnQgaWQgaS5lLiBuYW1lIG9mIHRoZSBmaWxlXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIFRlc3QgdmFyaWFibGVzXG4gKiB2YXIgaWQgPSBcIjEyMzQ1XCI7XG4gKiB2YXIgcmV2ID0gXCIxLUE2MTU3QTVFQTU0NUM5OUIwMEZGOTA0RUVGMDVGRDlGXCI7XG4gKiB2YXIgYXR0YWNobWVudElkID0gJ2ZpbGUudHh0JztcbiAqIC8vIENhbGwgdGhlIHNhdmVBdHRhY2htZW50IG1ldGhvZFxuICogZGFvLmRlbGV0ZUF0dGFjaG1lbnQoaWQsIHJldiwgYXR0YWNobWVudElkKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAqICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gKiB9LGZ1bmN0aW9uKGVycm9yKXtcbiAqICBjb25zb2xlLmxvZyhlcnJvcik7XG4gKiB9KTtcbiAqIC8vIEV4YW1wbGUgcmV0dXJuXG4gKiB7IFwib2tcIjogdHJ1ZSwgXCJyZXZcIjogXCIyLTFGOTgzMjExQUI4N0VGQ0NDOTgwOTc0REZDMjczODJGXCIgfVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3BvbnNlIGNvbnRhaW5zIHRoZSB0aGUgbmV3IHJldiwgYW5kIGFuIG9rIHRvIHJlYXNzdXJlIHlvdSB0aGF0XG4gKiBldmVyeXRoaW5nIGlzIG9rYXkuXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuZGVsZXRlQXR0YWNobWVudCA9IGZ1bmN0aW9uKGlkLCByZXYsIGF0dGFjaGVtbnRJZCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gRGVsZXRlIHRoZSBhdHRhY2htZW50IGZyb20gdGhlIGRvY3VtZW50IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIERlbGV0ZSB0aGUgYXR0YWNobWVudCBmcm9tIHRoZSBkb2N1bWVudCBpbiB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnLycgKyBpZCArICAnLycgKyBhdHRhY2hlbW50SWQgKyAnP3Jldj0nICsgcmV2LFxuXHRcdFx0XHR0eXBlOiAnREVMRVRFJyxcblx0XHRcdFx0ZGF0YVR5cGU6ICdqc29uJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ05hdGl2ZSAtIGVycm9yIGRlbGV0aW5nIGF0dGFjaG1lbnQgZm9yIHRoZSBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIGF0dGFjaG1lbnQgZnJvbSB0aGUgZG9jdW1lbnQgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIucmVtb3ZlQXR0YWNobWVudChpZCwgYXR0YWNoZW1udElkLCByZXYpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ0VSUkNPREU6ICcgKyBlcnIuc3RhdHVzICsgJyAoICcgKyBlcnIubmFtZSArICcgKSAnICsgJy0gRXJyb3IgZGVsZXRpbmcgYXR0YWNobWVudCBmb3IgdGhlIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuICcgKyBlcnIubWVzc2FnZSArICcuJyk7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogVGhpcyBtZXRob2QgY3JlYXRlcyBvciB1cGRhdGVzIGEgZGVzaWduIGRvY3VtZW50LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBkb2NJZCAtIERlc2lnbiBkb2N1bWVudCBpZFxuICogQHBhcmFtIHtzdHJpbmd9IHZpZXdJZCAtIERlc2lnbiBkb2N1bWVudCB2aWV3IGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gZnVuYyAtIERlc2lnbiBkb2N1bWVudCB2aWV3IGxvZ2ljLCBzaG91bGQgYmUgYSBKYXZhc2NyaXB0IHN0cmluZ1xuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgZGFvID0gbmV3IERhdGFiYXNlKHsgZGJuYW1lOiAnZGVmYXVsdCcgfSk7XG4gKlxuICpcbiAqIEByZXR1cm4gSlNPTiBzdGFuZGFyZCByZXNwb25zZVxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmNyZWF0ZURvY1ZpZXcgPSBmdW5jdGlvbihkb2NJZCwgdmlld0lkLCBqc0Z1bmN0aW9uKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBDcmVhdGUgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIENyZWF0ZSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgZGRvYyA9IHtcblx0XHRcdFx0J2xhbmd1YWdlJyA6ICdqYXZhc2NyaXB0Jyxcblx0XHRcdFx0J3ZpZXdzJyA6IHt9XG5cdFx0XHR9O1xuXHRcdFx0dmFyIGZ1bmMgPSAnZnVuY3Rpb24oZG9jKSB7ICcgKyBqc0Z1bmN0aW9uLnRvU3RyaW5nKCkgKyAnIH0nO1xuXHRcdFx0ZGRvYy52aWV3c1t2aWV3SWRdID0geyAnbWFwJzogZnVuYyB9O1xuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvX2Rlc2lnbi8nICsgZG9jSWQsXG5cdFx0XHRcdHR5cGU6ICdQVVQnLFxuXHRcdFx0XHRkYXRhOiBkZG9jLFxuXHRcdFx0XHRkYXRhVHlwZTogJ2pzb24nLFxuXHRcdFx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTmF0aXZlIC0gZXJyb3IgY3JlYXRpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gQ3JlYXRlIHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBpbiB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0dmFyIGRkb2MgPSB7XG5cdFx0XHRcdCdfaWQnIDogJ19kZXNpZ24vJyArIGRvY0lkLFxuXHRcdFx0XHQndmlld3MnIDoge31cblx0XHRcdH07XG5cdFx0XHR2YXIgZnVuYyA9ICdmdW5jdGlvbihkb2MpIHsgJyArIGpzRnVuY3Rpb24udG9TdHJpbmcoKSArICcgfSc7XG5cdFx0XHRkZG9jLnZpZXdzW3ZpZXdJZF0gPSB7ICdtYXAnOiBmdW5jIH07XG5cdFx0XHRzZWxmLnNhdmUoZGRvYykudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGlmIChlcnIuc3RhdHVzICE9PSA0MDkpIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oJ0Jyb3dzZXIgLSBlcnJvciBjcmVhdGluZyB0aGUgZGVzaWduIGRvY3VtZW50IHdpdGggdGhlIGlkOiAnICsgZG9jSWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgZXJyKTtcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRjb25zb2xlLndhcm4oZXJyKTtcblx0XHRcdFx0XHRyZXNvbHZlKHt9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogVGhpcyByZXF1ZXN0IHJldHJpZXZlcyBhIGRlc2lnbiBkb2N1bWVudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jSWQgLSBEZXNpZ24gZG9jdW1lbnQgaWRcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGRhbyA9IG5ldyBEYXRhYmFzZSh7IGRibmFtZTogJ2RlZmF1bHQnIH0pO1xuICpcbiAqXG4gKiBAcmV0dXJuIEpTT04gc3RhbmRhcmQgcmVzcG9uc2VcbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5nZXREb2NWaWV3ID0gZnVuY3Rpb24oZG9jSWQpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEdldCB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gR2V0IHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBpbiB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnL19kZXNpZ24vJyArIGRvY0lkLFxuXHRcdFx0XHR0eXBlOiAnR0VUJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ05hdGl2ZSAtIGVycm9yIGdldHRpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gR2V0IHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBpbiB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0c2VsZi5nZXQoJ19kZXNpZ24vJyArIGRvY0lkKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdCcm93c2VyIC0gZXJyb3IgZ2V0dGluZyB0aGUgZGVzaWduIGRvY3VtZW50IHdpdGggdGhlIGlkOiAnICsgZG9jSWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgZXJyKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBUaGlzIHJlcXVlc3QgZGVsZXRlcyB0aGUgZGVzaWduIGRvY3VtZW50IGZyb20gdGhlIHNwZWNpZmllZCBkYXRhYmFzZS5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jSWQgLSBEZXNpZ24gZG9jdW1lbnQgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSByZXYgLSBEZXNpZ24gZG9jdW1lbnQgcmV2aXNpb24gaWRcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGRhbyA9IG5ldyBEYXRhYmFzZSh7IGRibmFtZTogJ2RlZmF1bHQnIH0pO1xuICpcbiAqXG4gKiBAcmV0dXJuIEpTT04gc3RhbmRhcmQgcmVzcG9uc2VcbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5kZWxldGVEb2NWaWV3ID0gZnVuY3Rpb24oZG9jSWQsIHJldil7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gRGVsZXRlIHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGluIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvX2Rlc2lnbi8nICsgZG9jSWQgKyAnP3Jldj0nICsgcmV2LFxuXHRcdFx0XHR0eXBlOiAnREVMRVRFJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ05hdGl2ZSAtIGVycm9yIGRlbGV0aW5nIHRoZSBkZXNpZ24gZG9jdW1lbnQgd2l0aCB0aGUgaWQ6ICcgKyBkb2NJZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIERlbGV0ZSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYucmVtb3ZlKCdfZGVzaWduLycgKyBkb2NJZCwgcmV2KS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdCcm93c2VyIC0gZXJyb3IgZGVsZXRpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogSW52b2tlIGEgbWFwL3JlZHVjZSBmdW5jdGlvbiwgd2hpY2ggYWxsb3dzIHlvdSB0byBwZXJmb3JtIG1vcmUgY29tcGxleCBxdWVyaWVzIG9uIFBvdWNoREJcbiAqIG9yIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlcy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jSWQgLSBEZXNpZ24gZG9jdW1lbnQgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB2aWV3SWQgLSBEZXNpZ24gZG9jdW1lbnQgdmlldyBpZFxuICogQHBhcmFtIHtPYmplY3R9IG9wdHMgLSBNYXAgcmVkdWNlIG9wdGlvbnNcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGRhbyA9IG5ldyBEYXRhYmFzZSh7IGRibmFtZTogJ2RlZmF1bHQnIH0pO1xuICpcbiAqIEB0b2RvIEFkZCBhbGwgdGhlIG9wdGlvbmFsIHF1ZXJ5IG9wdGlvbnNcbiAqXG4gKiBAcmV0dXJuIEpTT04gc3RhbmRhcmQgcmVzcG9uc2VcbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5xdWVyeSA9IGZ1bmN0aW9uKGRvY0lkLCB2aWV3SWQsIG9wdHMpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIFF1ZXJ5IHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBRdWVyeSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgcGFyYW1zID0gJ2luY2x1ZGVfZG9jcz10cnVlJmtleT0nICsgb3B0cy5rZXk7XG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy9fZGVzaWduLycgKyBkb2NJZCArICcvX3ZpZXcvJyArIHZpZXdJZCArICc/JyArIHBhcmFtcyxcblx0XHRcdFx0dHlwZTogJ0dFVCcsXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbidcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdOYXRpdmUgLSBlcnJvciBxdWVyeWluZyB0aGUgZGVzaWduIGRvY3VtZW50IHdpdGggdGhlIGlkOiAnICsgZG9jSWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBRdWVyeSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHZhciBwYWdlU2l6ZSA9IG9wdHMucGFnZVNpemUgfHwgMTAwO1xuXHRcdFx0dmFyIHBhZ2VJbmRleCA9IG9wdHMucGFnZUluZGV4IHx8IDA7XG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0a2V5OiBvcHRzLmtleSxcblx0XHRcdFx0bGltaXQ6IHBhZ2VTaXplLFxuXHRcdFx0XHRza2lwOiBwYWdlSW5kZXggKiBwYWdlU2l6ZSxcbiAgICBcdFx0XHRpbmNsdWRlX2RvY3M6IHRydWVcblx0XHRcdH07XG5cdFx0XHRzZWxmLmRiLnF1ZXJ5KGRvY0lkICsgJy8nICsgdmlld0lkLCBvcHRpb25zKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdFUlJDT0RFOiAnICsgZXJyLnN0YXR1cyArICcgKCAnICsgZXJyLm5hbWUgKyAnICkgJyArICctIHF1ZXJ5aW5nIHRoZSBkZXNpZ24gZG9jdW1lbnQgd2l0aCB0aGUgaWQ6ICcgKyBpZCArICcuICcgKyBlcnIubWVzc2FnZSArICcuJyk7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogQXV0aGVudGljYXRlIGEgdXNlciBhZ2FpbnN0IHRoZSBDb3VjaGJhc2UgU3luYyBHYXRld2F5LlxuICpcbiAqIEBleGFtcGxlXG4gKiBkYW8uYXV0aGVudGljYXRlVG9TeW5jR2F0ZXdheSgpO1xuICpcbiAqIEByZXR1cm4gSlNPTiBzdGFuZGFyZCByZXNwb25zZVxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmF1dGhlbnRpY2F0ZVRvU3luY0dhdGV3YXkgPSBmdW5jdGlvbigpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdHZhciB1cmwgPSBzZWxmLnN5bmNVUkwgKyAnL19zZXNzaW9uJztcblx0XHR2YXIgbWV0aG9kID0gJ1BPU1QnO1xuXHRcdHZhciBwb3N0RGF0YSA9IEpTT04uc3RyaW5naWZ5KHtcblx0XHRcdCduYW1lJzogc2VsZi51c2VybmFtZSwgJ3Bhc3N3b3JkJzogc2VsZi5wYXNzd29yZFxuXHRcdH0pO1xuXHRcdHZhciBhc3luYyA9IHRydWU7XG5cdFx0dmFyIHJlcXVlc3QgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblx0XHRyZXF1ZXN0LndpdGhDcmVkZW50aWFscyA9IHRydWU7XG5cdFx0cmVxdWVzdC5vbmxvYWQgPSBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBzdGF0dXMgPSByZXF1ZXN0LnN0YXR1cztcblx0XHRcdHZhciBkYXRhID0gcmVxdWVzdC5yZXNwb25zZVRleHQ7XG5cdFx0XHRpZihzdGF0dXMgPT0gMjAwKSB7XG5cdFx0XHRcdHNlbGYuYXV0aGVudGljYXRlZCA9IHRydWU7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZWplY3QoZGF0YSk7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJlcXVlc3Qub3BlbihtZXRob2QsIHVybCwgYXN5bmMpO1xuXHRcdHJlcXVlc3Quc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL2pzb247IGNoYXJzZXQ9VVRGLTgnKTtcblx0XHRyZXF1ZXN0LnNlbmQocG9zdERhdGEpO1xuXHR9KTtcbn07XG5cbi8qKlxuICogVGhpcyByZXF1ZXN0IHJldHJpZXZlcyBhIHNvcnRlZCBsaXN0IG9mIGNoYW5nZXMgbWFkZSB0byBkb2N1bWVudHMgaW4gdGhlIGRhdGFiYXNlLFxuICogaW4gdGltZSBvcmRlciBvZiBhcHBsaWNhdGlvbi5cbiAqXG4gKiBAcGFyYW0ge09iamVjdH0gb3B0c1xuICogXHRAcGFyYW0ge3N0cmluZ30gb3B0cy5saW1pdFxuICpcdFRoZSBtYXggYW1vdW50IG9mIGRvY3VtZW50IGNoYW5nZXMgdG8gcmV0dXJuXG4gKiBcdEBwYXJhbSB7c3RyaW5nfSBvcHRzLnNpbmNlXG4gKlx0VGhlIGxhc3QgY2hhbmdlIHNlcXVlbmNlXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuY2hhbmdlcyA9IGZ1bmN0aW9uKG9wdHMpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEdldCB0aGUgbW9zdCByZWNlbnRseSBjaGFuZ2VkIGRvY3VtZW50cyBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBHZXQgdGhlIG1vc3QgcmVjZW50bHkgY2hhbmdlZCBkb2N1bWVudHMgZnJvbSB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBwYXJhbXMgPSAnbGltaXQ9MTAwJnNpbmNlPScrIHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxO1xuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvX2NoYW5nZXM/JyArIHBhcmFtcyxcblx0XHRcdFx0dHlwZTogJ0dFVCcsXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbidcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdOYXRpdmUgLSBlcnJvciByZXRyaWV2aW5nIHRoZSBsYXRlc3QgY2hhbmdlcy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gR2V0IHRoZSBtb3N0IHJlY2VudGx5IGNoYW5nZWQgZG9jdW1lbnRzIGZyb20gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHZhciBwYXJhbXMgPSB7XG5cdFx0XHRcdGxpbWl0OiAxMDAsXG5cdFx0XHRcdHNpbmNlOiBzZWxmLl9zZXR0aW5ncy5sYXN0U3luY1NlcVxuXHRcdFx0fTtcblx0XHRcdHZhciBvcHRpb25zID0gb3B0cyB8fCBwYXJhbXM7XG5cdFx0XHRzZWxmLmRiLmNoYW5nZXMob3B0aW9ucykudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignRVJSQ09ERTogJyArIGVyci5zdGF0dXMgKyAnICggJyArIGVyci5uYW1lICsgJyApICcgKyAnLSByZXRyaWV2aW5nIHRoZSBsYXRlc3QgY2hhbmdlczogJyArIGlkICsgJy4gJyArIGVyci5tZXNzYWdlICsgJy4nKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBSZXBsaWNhdGUgZGF0YSBmcm9tIHNvdXJjZSB0byB0YXJnZXQuIEJvdGggdGhlIHNvdXJjZSBhbmQgdGFyZ2V0IGNhbiBiZSBhIFBvdWNoREJcbiAqIGluc3RhbmNlIG9yIGEgc3RyaW5nIHJlcHJlc2VudGluZyBhIENvdWNoREIvIENvdWNoYmFzZSBkYXRhYmFzZSBVUkwuXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuc3RhcnRQdWxsID0gZnVuY3Rpb24oKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBHZXQgdGhlIGRvY3VtZW50cyBmcm9tIHRoZSBzZXJ2ZXIgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gR2V0IHRoZSBkb2N1bWVudHMgZnJvbSB0aGUgc2VydmVyIGZvciB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2UuXG5cdFx0XHQvLyBVc2UgdGhlIGNvcmRvdmEuZXhlYyBmdW5jdGlvbiB0byBjYWxsIHRoZSBwdWxsIGFjdGlvbi5cblx0XHRcdGNvcmRvdmEuZXhlYyhmdW5jdGlvbihzdWNjZXNzKXtcblx0XHRcdFx0cmVzb2x2ZShzdWNjZXNzKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycm9yKXtcblx0XHRcdFx0cmVqZWN0KGVycm9yKTtcblx0XHRcdH0sXG5cdFx0XHRcdCdDQkxpdGUnLCAncHVsbCcsXG5cdFx0XHRcdFt7XG5cdFx0XHRcdFx0J2RibmFtZSc6IHNlbGYuZGJuYW1lLFxuXHRcdFx0XHRcdCd1cmwnOiBzZWxmLnN5bmNVUkxcblx0XHRcdFx0fV1cblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgZG9jdW1lbnRzIGZyb20gdGhlIHNlcnZlciBmb3IgdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIucmVwbGljYXRlLmZyb20obmV3IFBvdWNoREIoc2VsZi5zeW5jVVJMKSkudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignRVJSQ09ERTogJyArIGVyci5zdGF0dXMgKyAnICggJyArIGVyci5uYW1lICsgJyApICcgKyAnLSByZXRyaWV2aW5nIHRoZSBsYXRlc3QgY2hhbmdlczogJyArIGlkICsgJy4gJyArIGVyci5tZXNzYWdlICsgJy4nKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuXG4vKipcbiAqIFN5bmMgZGF0YSBmcm9tIHNyYyB0byB0YXJnZXQgYW5kIHRhcmdldCB0byBzcmMuIFRoaXMgaXMgYSBjb252ZW5pZW5jZSBtZXRob2QgZm9yXG4gKiBiaWRpcmVjdGlvbmFsIGRhdGEgcmVwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IHNvdXJjZSAtIFRoZSBzb3VyY2UgZGF0YWJhc2VcbiAqIEBwYXJhbSB7c3RyaW5nfSB0YXJnZXQgLSBUaGUgdGFyZ2V0IGRhdGFiYXNlXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuc3RhcnRTeW5jID0gZnVuY3Rpb24oKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHR2YXIgc3luY1VzZXJuYW1lID0gc2VsZi5fc2V0dGluZ3Muc3Vic2NyaXB0aW9ucy51c2VybmFtZTtcbiAgICB2YXIgc3luY1Bhc3N3b3JkID0gc2VsZi5fc2V0dGluZ3Muc3Vic2NyaXB0aW9ucy5wYXNzd29yZDtcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gU3luY2hyb25pc2UgYWxsIHRoZSBkb2N1bWVudHMgZnJvbSB0aGUgc2VydmVyIGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIFN5bmNocm9uaXNlIGFsbCB0aGUgZG9jdW1lbnRzIGZyb20gdGhlIHNlcnZlciBmb3IgdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHRjb3Jkb3ZhLmV4ZWMoZnVuY3Rpb24oc2VxKXtcblx0XHRcdFx0aWYoc2VsZi5fc2V0dGluZ3MubGFzdFN5bmNTZXEgPT09IHNlcSl7XG5cdFx0XHRcdFx0c2VsZi5fc2V0dGluZ3MubGFzdFN5bmNTZXEgPSBzZXE7XG5cdFx0XHRcdFx0c2VsZi5zYXZlKHNlbGYuX3NldHRpbmdzKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSxcblx0XHRcdFx0J0NCTGl0ZScsICdzeW5jJyxcblx0XHRcdFx0W3tcblx0XHRcdFx0XHQnZGJuYW1lJzogc2VsZi5kYm5hbWUsXG5cdFx0XHRcdFx0J3VybCc6ICdodHRwOi8vJyArIHN5bmNVc2VybmFtZSArICc6JyArIHN5bmNQYXNzd29yZCArICdAJyArIHNlbGYuc3luY1VSTC5yZXBsYWNlKCdodHRwOi8vJywnJylcblx0XHRcdFx0fV1cblx0XHRcdCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIFN5bmNocm9uaXNlIGFsbCB0aGUgZG9jdW1lbnRzIGZyb20gdGhlIHNlcnZlciBmb3IgdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdGlmKHNlbGYuYXV0aGVudGljYXRlZCA9PT0gZmFsc2Upe1xuXHRcdFx0XHRzZWxmLmF1dGhlbnRpY2F0ZVRvU3luY0dhdGV3YXkoc3luY1VzZXJuYW1lLCBzeW5jUGFzc3dvcmQpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdFx0c2VsZi5kYi5zeW5jKG5ldyBQb3VjaERCKHNlbGYuc3luY1VSTCksIHsgbGl2ZTogdHJ1ZSwgcmV0cnk6IHRydWUgfSlcblx0XHRcdFx0XHQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlcSA9IGRhdGEubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzZWxmLl9zZXR0aW5ncy5sYXN0U3luY1NlcSAhPT0gc2VxKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICBcdHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxID0gc2VxO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcdHNlbGYuc2F2ZShzZWxmLl9zZXR0aW5ncykudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXHRcdHJlc29sdmUoZGF0YSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHR9XG4gICAgICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgICAgIC5vbignZXJyb3InLCBmdW5jdGlvbihlcnIpe1xuICAgICAgICAgICAgICAgICAgICBcdHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcblx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzZWxmLmRiLnN5bmMobmV3IFBvdWNoREIoc2VsZi5zeW5jVVJMKSwgeyBsaXZlOiB0cnVlLCByZXRyeTogdHJ1ZSB9KVxuXHRcdFx0XHQub24oJ2NoYW5nZScsIGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICB2YXIgc2VxID0gZGF0YS5sYXN0X3NlcTtcbiAgICAgICAgICAgICAgICAgICAgaWYoc2VsZi5fc2V0dGluZ3MubGFzdFN5bmNTZXEgIT09IHNlcSl7XG4gICAgICAgICAgICAgICAgICAgICBcdHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxID0gc2VxO1xuICAgICAgICAgICAgICAgICAgICAgIFx0c2VsZi5zYXZlKHNlbGYuX3NldHRpbmdzKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuICAgICAgICAgICAgICAgICAgICAgIFx0XHRyZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgIFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAub24oJ2Vycm9yJywgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgICAgICBcdHJlamVjdChlcnIpO1xuICAgICAgICAgICAgICAgIH0pO1xuXHRcdFx0fVxuXHRcdH1cblx0fSk7XG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IERhdGFiYXNlO1xuIl19
