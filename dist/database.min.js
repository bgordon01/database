(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.Database = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
(function (global){
"use strict";function Database(e,t){if(t=t||{},this.dbname=e,this.syncURL=t.syncURL||"http://kwantu10.kwantu.net:8000/kwantu_apps",this.username=t.username||"",this.password=t.password||"",this.mock=t.mock||!1,this.adapter="pouchdb",this.url="http://localhost:59840",this.db={},this.authenticated=!1,this._settings={_id:"_local/settings",lastSynSeq:0,session:{},subscriptions:{}},this.createDB=function(){void 0===global?window.cblite?(this.adapter="couchbase",window.cblite.getURL(function(e,t){if(e)throw"Couchbase Lite Initilization error - "+JSON.stringify(e);this.url=t;try{var n=new XMLHttpRequest;n.open("GET",this.url,!1),n.send(null)}catch(e){throw"Android version 4.1 error - "+JSON.stringify(e)}var a={url:this.url+"/"+this.dbname,type:"PUT",data:"",dataType:"JSON",contentType:"application/json"},r=$.ajax(a);r.done(function(e,t,n){console.log(n.responseText)}).fail(function(e,t,n){console.log(e.responseText)})})):(this.adapter="pouchdb",console.warn("Couchbase Lite plugin not found. Creating the PouchDB database."),this.mock===!0?this.db=new PouchDB(this.dbname,{adapter:"memory"}):this.db=new PouchDB(this.dbname)):(this.adapter="couchdb",this.db=new PouchDB("http://localhost:5984/"+this.dbname))},void 0===e)throw"DBERROR: A database name is required i.e. var db = new Database('default');";this.createDB()}Database.prototype.deleteDB=function(){var e=this;return new Promise(function(t,n){if("couchbase"===e.adapter){var a={url:e.url+"/"+e.dbname,type:"DELETE"};$.ajax(a).done(function(e,n,a){t(e)}).fail(function(e,t,a){console.log("Native - error deleting database. Error stacktrace: "+JSON.stringify(e)),n(e.responseText)})}else e.db.destroy().then(function(e){t(e)}).catch(function(e){console.log("Browser - error deleting database. Error stacktrace: "+e),n(e)})})},Database.prototype.save=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/"+e._id+"?rev="+e._rev,type:"PUT",data:JSON.stringify(e),contentType:"application/json",dataType:"json"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.log("Native - error saving document with id: "+e._id+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.db.put(e).then(function(e){n(e)}).catch(function(t){console.log("Browser - error saving document with id: "+e._id+". Error stacktrace: "+t),a(t)})})},Database.prototype.get=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/"+e,type:"GET",dataType:"json"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.log("Native - error getting document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.db.get(e).then(function(e){n(e)}).catch(function(t){console.log("Browser - error getting document with id: "+e+". Error stacktrace: "+t),a(t)})})},Database.prototype.remove=function(e,t){var n=this;return new Promise(function(a,r){if("couchbase"===n.adapter){var o={url:n.url+"/"+n.dbname+"/"+e+"?rev="+t,type:"DELETE",Accept:"application/json",dataType:"json"};$.ajax(o).done(function(e,t,n){a(e)}).fail(function(t,n,a){console.log("Native - error deleting document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),r(t.responseText)})}else n.db.remove(e,t).then(function(e){a(e)}).catch(function(t){console.log("Browser - error deleting document with id: "+e+". Error stacktrace: "+t),r(t)})})},Database.prototype.saveAttachment=function(e,t,n,a,r){var o=this;return new Promise(function(i,s){if("couchbase"===o.adapter){var c={url:o.url+"/"+o.dbname+"/"+e+"/"+r+"?rev="+t,type:"PUT",data:n,dataType:"json",contentType:a};$.ajax(c).done(function(e,t,n){i(e)}).fail(function(t,n,a){console.log("Native - error saving attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),s(t.responseText)})}else o.db.putAttachment(e,r,t,n,a).then(function(e){i(e)}).catch(function(t){console.log("Browser - error saving attachment for the document with id: "+e+". Error stacktrace: "+t),s(t)})})},Database.prototype.getAttachment=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={url:a.url+"/"+a.dbname+"/"+e+"/"+n+"?rev="+t,type:"GET"};$.ajax(i).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error retrieving attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else a.db.getAttachment(e,n,{rev:t}).then(function(e){r(e)}).catch(function(t){console.warn("Browser - error retrieving attachment for the document with id: "+e+". Error stacktrace: "+t),o(t)})})},Database.prototype.deleteAttachment=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={url:a.url+"/"+a.dbname+"/"+e+"/"+n+"?rev="+t,type:"DELETE",dataType:"json"};$.ajax(i).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error deleting attachment for the document with id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else a.db.removeAttachment(e,n,t).then(function(e){r(e)}).catch(function(t){console.warn("ERRCODE: "+t.status+" ( "+t.name+" ) - Error deleting attachment for the document with id: "+e+". "+t.message+"."),o(t)})})},Database.prototype.createDocView=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i={language:"javascript",views:{}},s="function(doc) { "+n.toString()+" }";i.views[t]={map:s};var c={url:a.url+"/"+a.dbname+"/_design/"+e,type:"PUT",data:i,dataType:"json",contentType:"application/json"};$.ajax(c).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error creating the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else{var i={_id:"_design/"+e,views:{}},s="function(doc) { "+n.toString()+" }";i.views[t]={map:s},a.save(i).then(function(e){r(e)},function(t){409!==t.status?(console.warn("Browser - error creating the design document with the id: "+e+". Error stacktrace: "+t),o(t)):(console.warn(t),r({}))})}})},Database.prototype.getDocView=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r={url:t.url+"/"+t.dbname+"/_design/"+e,type:"GET"};$.ajax(r).done(function(e,t,a){n(e)}).fail(function(t,n,r){console.warn("Native - error getting the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),a(t.responseText)})}else t.get("_design/"+e).then(function(e){n(e)},function(t){console.warn("Browser - error getting the design document with the id: "+e+". Error stacktrace: "+t),a(t)})})},Database.prototype.deleteDocView=function(e,t){var n=this;return new Promise(function(a,r){if("couchbase"===n.adapter){var o={url:n.url+"/"+n.dbname+"/_design/"+e+"?rev="+t,type:"DELETE"};$.ajax(o).done(function(e,t,n){a(e)}).fail(function(t,n,a){console.warn("Native - error deleting the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),r(t.responseText)})}else n.remove("_design/"+e,t).then(function(e){a(e)},function(t){console.warn("Browser - error deleting the design document with the id: "+e+". Error stacktrace: "+t),r(t)})})},Database.prototype.query=function(e,t,n){var a=this;return new Promise(function(r,o){if("couchbase"===a.adapter){var i="include_docs=true&key="+n.key,s={url:a.url+"/"+a.dbname+"/_design/"+e+"/_view/"+t+"?"+i,type:"GET",dataType:"json"};$.ajax(s).done(function(e,t,n){r(e)}).fail(function(t,n,a){console.warn("Native - error querying the design document with the id: "+e+". Error stacktrace: "+JSON.stringify(t)),o(t.responseText)})}else{var c=n.pageSize||100,u=n.pageIndex||0,s={key:n.key,limit:c,skip:u*c,include_docs:!0};a.db.query(e+"/"+t,s).then(function(e){r(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - querying the design document with the id: "+id+". "+e.message+"."),o(e)})}})},Database.prototype.authenticateToSyncGateway=function(){var e=this;return new Promise(function(t,n){var a=e.syncURL+"/_session",r="POST",o=JSON.stringify({name:e.username,password:e.password}),i=!0,s=new XMLHttpRequest;s.withCredentials=!0,s.onload=function(){var a=s.status,r=s.responseText;200==a?(e.authenticated=!0,t(r)):n(r)},s.open(r,a,i),s.setRequestHeader("Content-Type","application/json; charset=UTF-8"),s.send(o)})},Database.prototype.changes=function(e){var t=this;return new Promise(function(n,a){if("couchbase"===t.adapter){var r="limit=100&since="+t._settings.lastSyncSeq,o={url:t.url+"/"+t.dbname+"/_changes?"+r,type:"GET",dataType:"json"};$.ajax(o).done(function(e,t,a){n(e)}).fail(function(e,t,n){console.warn("Native - error retrieving the latest changes. Error stacktrace: "+JSON.stringify(e)),a(e.responseText)})}else{var r={limit:100,since:t._settings.lastSyncSeq},o=e||r;t.db.changes(o).then(function(e){n(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - retrieving the latest changes: "+id+". "+e.message+"."),a(e)})}})},Database.prototype.startPull=function(){var e=this;return new Promise(function(t,n){"couchbase"===e.adapter?cordova.exec(function(e){t(e)},function(e){n(e)},"CBLite","pull",[{dbname:e.dbname,url:e.syncURL}]):e.db.replicate.from(new PouchDB(e.syncURL)).then(function(e){t(e)}).catch(function(e){console.warn("ERRCODE: "+e.status+" ( "+e.name+" ) - retrieving the latest changes: "+id+". "+e.message+"."),n(e)})})},Database.prototype.startSync=function(){var e=this,t=e._settings.subscriptions.username,n=e._settings.subscriptions.password;return new Promise(function(a,r){"couchbase"===e.adapter?cordova.exec(function(t){e._settings.lastSyncSeq===t&&(e._settings.lastSyncSeq=t,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))},function(e){r(e)},"CBLite","sync",[{dbname:e.dbname,url:"http://"+t+":"+n+"@"+e.syncURL.replace("http://","")}]):e.authenticated===!1?e.authenticateToSyncGateway(t,n).then(function(t){e.db.sync(new PouchDB(e.syncURL),{live:!0,retry:!0}).on("change",function(t){var n=t.last_seq;e._settings.lastSyncSeq!==n&&(e._settings.lastSyncSeq=n,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))}).on("error",function(e){r(e)})},function(e){r(e)}):e.db.sync(new PouchDB(e.syncURL),{live:!0,retry:!0}).on("change",function(t){var n=t.last_seq;e._settings.lastSyncSeq!==n&&(e._settings.lastSyncSeq=n,e.save(e._settings).then(function(e){a(e)},function(e){r(e)}))}).on("error",function(e){r(e)})})},module.exports=Database;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})

},{}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3Vzci9sb2NhbC9saWIvbm9kZV9tb2R1bGVzL2Jyb3dzZXJpZnkvbm9kZV9tb2R1bGVzL2Jyb3dzZXItcGFjay9fcHJlbHVkZS5qcyIsImluZGV4LmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOztBQ0FBLFlBOEJBLFNBQVMsVUFBUyxFQUFRLEdBbUl6QixHQWpJQSxFQUFVLE1BT1YsS0FBSyxPQUFTLEVBUWQsS0FBSyxRQUFVLEVBQVEsU0FBVyw4Q0FPbEMsS0FBSyxTQUFXLEVBQVEsVUFBWSxHQU9wQyxLQUFLLFNBQVcsRUFBUSxVQUFZLEdBUXBDLEtBQUssS0FBTyxFQUFRLE9BQVEsRUFTNUIsS0FBSyxRQUFVLFVBU2YsS0FBSyxJQUFNLHlCQVFYLEtBQUssTUFDTCxLQUFLLGVBQWdCLEVBQ3JCLEtBQUssV0FDSixJQUFJLGtCQUNKLFdBQVksRUFDWixXQUNBLGtCQUdELEtBQUssU0FBVyxXQUVBLFNBQVgsT0FFQyxPQUFPLFFBRVYsS0FBSyxRQUFVLFlBRWYsT0FBTyxPQUFPLE9BQU8sU0FBUyxFQUFLLEdBQ2xDLEdBQUksRUFFSCxLQUFNLHdDQUEwQyxLQUFLLFVBQVUsRUFFL0QsTUFBSyxJQUFNLENBRVgsS0FDQyxHQUFJLEdBQVUsR0FBSSxlQUNsQixHQUFRLEtBQUssTUFBTyxLQUFLLEtBQUssR0FDOUIsRUFBUSxLQUFLLE1BQ1osTUFBTSxHQUNQLEtBQU0sK0JBQWlDLEtBQUssVUFBVSxHQUd2RCxHQUFJLElBQ0gsSUFBSyxLQUFLLElBQU0sSUFBTSxLQUFLLE9BQzNCLEtBQU0sTUFDTixLQUFNLEdBQ04sU0FBVSxPQUNWLFlBQWEsb0JBRVYsRUFBUSxFQUFFLEtBQUssRUFDbkIsR0FBTSxLQUFLLFNBQVMsRUFBTSxFQUFZLEdBQ3JDLFFBQVEsSUFBSSxFQUFNLGdCQUNoQixLQUFLLFNBQVMsRUFBTyxFQUFZLEdBQ25DLFFBQVEsSUFBSSxFQUFNLG9CQU1yQixLQUFLLFFBQVUsVUFFZixRQUFRLEtBQUssbUVB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LFVBQVUsY0FBZ0IsSUFDaEMsRUFBSyxVQUFVLFlBQWMsRUFDNUIsRUFBSyxLQUFLLEVBQUssV0FBVyxLQUFLLFNBQVMsR0FDdkMsRUFBUSxJQUNOLFNBQVMsR0FDL0IsRUFBTyxRQUlNLEdBQUcsUUFBUyxTQUFTLEdBQ3JCLEVBQU8sTUFFckIsU0FBUyxHQUNYLEVBQU8sS0FHUixFQUFLLEdBQUcsS0FBSyxHQUFJLFNBQVEsRUFBSyxVQUFZLE1BQU0sRUFBTSxPQUFPLElBQzVELEdBQUcsU0FBVSxTQUFTLEdBQ1AsR0FBSSxHQUFNLEVBQUssUUFDWixHQUFLLFVBQVUsY0FBZ0IsSUFDaEMsRUFBSyxVQUFVLFlBQWMsRUFDNUIsRUFBSyxLQUFLLEVBQUssV0FBVyxLQUFLLFNBQVMsR0FDdkMsRUFBUSxJQUNOLFNBQVMsR0FDNUIsRUFBTyxRQUlHLEdBQUcsUUFBUyxTQUFTLEdBQ3JCLEVBQU8sUUFPeEIsT0FBTyxRQUFVIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIid1c2Ugc3RyaWN0JztcblxuLypnbG9iYWxzIEpTT04sIFBvdWNoREIsIFByb21pc2UgY29yZG92YSovXG5cbi8qKlxuICogUmVwcmVzZW50cyB0aGUgZ2VuZXJpYyBEYXRhYmFzZSAoIERhdGFiYXNlIEFjY2VzcyBPYmplY3QgKS4gVGhpcyBpcyBhIHdyYXBwZXIgbW9kdWxlXG4gKiB1c2VkIHRvIGludGVyZmFjZSB3aXRoIGVpdGhlciB0aGUgQ291Y2hiYXNlIExpdGUgb3IgUG91Y2hEQiBkYXRhYmFzZXMuXG4gKlxuICogQGNsYXNzXG4gKiBAcGFyYW0ge3N0cmluZ30gZGJuYW1lIC0gRGF0YWJhc2UgbmFtZVxuICogQHBhcmFtIHtPYmplY3R9IFtvcHRpb25zXVxuICogXHRAcGFyYW0ge3N0cmluZ30gb3B0aW9ucy5zeW5jVVJMXG4gKlx0U3luYyBnYXRld2F5IFVSTFxuICpcdEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnVzZXJuYW1lXG4gKlx0TG9nZ2VkIGluIHVzZXIncyB1c2VybmFtZVxuICpcdEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnBhc3N3b3JkXG4gKlx0TG9nZ2VkIGluIHVzZXIncyBwYXNzd29yZFxuICpcdEBwYXJhbSB7Ym9vbGVhbn0gb3B0aW9ucy5tb2NrXG4gKlx0VHJ1ZSAvIGZhbHNlIHZhbHVlIHVzZWQgZm9yIG1vY2sgdGVzdGluZ1xuICogQGF1dGhvciBTYXRpbmRlciBTaW5naCwgQnJlbnQgR29yZG9uXG4gKiBAdmVyc2lvbiAxLjAuMFxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgZGIgPSBuZXcgRGF0YWJhc2UoJ2RibmFtZScpO1xuICpcbiAqIEByZXR1cm4ge09iamVjdH0gbmV3IERhdGFiYXNlIGNvbnN0cnVjdG9yIC8gY2xhc3Mgb2JqZWN0XG4gKlxuICogQHRocm93cyBcIkRCRVJST1I6IEEgZGF0YWJhc2UgbmFtZSBpcyByZXF1aXJlZCBpLmUuIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoJ2RlZmF1bHQnKTtcIlxuICpcbiAqL1xuZnVuY3Rpb24gRGF0YWJhc2UoZGJuYW1lLCBvcHRpb25zKXtcblx0Ly8gb3B0aW9ucyBpcyBhbiBvcHRpb25hbCBwYXJhbWV0ZXJcblx0b3B0aW9ucyA9IG9wdGlvbnMgfHwge307XG5cdC8qKlxuXHQgKiBUaGUgZGF0YWJhc2UgbmFtZS5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjZGJuYW1lXG5cdCAqIEB0eXBlIFN0cmluZ1xuXHQgKi9cblx0dGhpcy5kYm5hbWUgPSBkYm5hbWU7XG5cdC8qKlxuXHQgKiBUaGUgQ291Y2hiYXNlIFN5bmMgR2F0ZXdheSBVUkwuXG5cdCAqXG5cdCAqIEBuYW1lIERhdGFiYXNlI3N5bmNVUkxcblx0ICogQHR5cGUgU3RyaW5nXG5cdCAqIEBkZWZhdWx0IFwiaHR0cDovL2t3YW50dTEwLmt3YW50dS5uZXQ6ODAwMC9rd2FudHVfYXBwc1wiXG5cdCAqL1xuXHR0aGlzLnN5bmNVUkwgPSBvcHRpb25zLnN5bmNVUkwgfHwgJ2h0dHA6Ly9rd2FudHUxMC5rd2FudHUubmV0OjgwMDAva3dhbnR1X2FwcHMnO1xuXHQvKipcblx0ICogVGhlIENvdWNoYmFzZSBTeW5jIEdhdGV3YXkgdXNlcidzIHVzZXJuYW1lLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSN1c2VybmFtZVxuXHQgKiBAdHlwZSBTdHJpbmdcblx0ICovXG5cdHRoaXMudXNlcm5hbWUgPSBvcHRpb25zLnVzZXJuYW1lIHx8ICcnO1xuXHQvKipcblx0ICogVGhlIENvdWNoYmFzZSBTeW5jIEdhdGV3YXkgdXNlcidzIHBhc3N3b3JkLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSNwYXNzd29yZFxuXHQgKiBAdHlwZSBTdHJpbmdcblx0ICovXG5cdHRoaXMucGFzc3dvcmQgPSBvcHRpb25zLnBhc3N3b3JkIHx8ICcnO1xuXHQvKipcblx0ICogVGhlIG1vY2sgZGF0YWJhc2UgZmxhZy5cblx0ICpcblx0ICogQG5hbWUgRGF0YWJhc2UjbW9ja1xuXHQgKiBAdHlwZSBCb29sZWFuXG5cdCAqIEBkZWZhdWx0IGZhbHNlXG5cdCAqL1xuXHR0aGlzLm1vY2sgPSBvcHRpb25zLm1vY2sgfHwgZmFsc2U7XG5cdC8qKlxuXHQgKiBUaGUgZGF0YWJhc2UgYWRhcHRlciB0eXBlLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSNhZGFwdGVyXG5cdCAqIEB0eXBlIFN0cmluZ1xuXHQgKiBAZGVmYXVsdCBcInBvdWNoZGJcIlxuXHQgKiBAcmVhZG9ubHlcblx0ICovXG5cdHRoaXMuYWRhcHRlciA9ICdwb3VjaGRiJztcblx0LyoqXG5cdCAqIFRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZSBVUkwuXG5cdCAqXG5cdCAqIEBuYW1lIERhdGFiYXNlI3VybFxuXHQgKiBAdHlwZSBTdHJpbmdcblx0ICogQGRlZmF1bHQgXCJodHRwOi8vbG9jYWxob3N0OjU5ODQwXCJcblx0ICogQHJlYWRvbmx5XG5cdCAqL1xuXHR0aGlzLnVybCA9ICdodHRwOi8vbG9jYWxob3N0OjU5ODQwJztcblx0LyoqXG5cdCAqIFRoZSBQb3VjaERCIGRhdGFiYXNlIGNvbnN0cnVjdG9yIGNsYXNzLlxuXHQgKlxuXHQgKiBAbmFtZSBEYXRhYmFzZSNkYlxuXHQgKiBAdHlwZSBPYmplY3Rcblx0ICogQHJlYWRvbmx5XG5cdCAqL1xuXHR0aGlzLmRiID0ge307XG5cdHRoaXMuYXV0aGVudGljYXRlZCA9IGZhbHNlO1xuXHR0aGlzLl9zZXR0aW5ncyA9IHtcblx0XHRfaWQ6J19sb2NhbC9zZXR0aW5ncycsXG5cdFx0bGFzdFN5blNlcTogMCxcblx0XHRzZXNzaW9uOiB7fSxcblx0XHRzdWJzY3JpcHRpb25zOiB7fVxuXHR9O1xuXHQvLyBJbml0aWFsaXNlIGZ1bmN0aW9uLCB1c2VkIHRvIGNyZWF0ZSB0aGUgZGF0YWJhc2Vcblx0dGhpcy5jcmVhdGVEQiA9IGZ1bmN0aW9uKCl7XG5cdFx0Ly9cblx0XHRpZiAoZ2xvYmFsID09PSB1bmRlZmluZWQpIHtcblx0XHRcdC8vIERldGVybWluZSBpZiB0aGlzIGlzIGEgbmF0aXZlIGRldmljZSBpLmUuIGlzIENvdWNoYmFzZSBMaXRlIGluc3RhbGxlZFxuXHRcdFx0aWYgKHdpbmRvdy5jYmxpdGUpe1xuXHRcdFx0XHQvLyBTZXQgdGhlIGFkYXB0ZXIgdHlwZVxuXHRcdFx0XHR0aGlzLmFkYXB0ZXIgPSAnY291Y2hiYXNlJztcblx0XHRcdFx0Ly8gR2V0IHRoZSBDb3VjaGJhc2UgTGl0ZSBsb2NhbCBVUkxcblx0XHRcdFx0d2luZG93LmNibGl0ZS5nZXRVUkwoZnVuY3Rpb24oZXJyLCB1cmwpIHtcblx0XHRcdFx0XHRpZiAoZXJyKSB7XG5cdFx0XHRcdFx0XHQvLyBMb2cgdGhlIGVycm9yXG5cdFx0XHRcdFx0XHR0aHJvdyAnQ291Y2hiYXNlIExpdGUgSW5pdGlsaXphdGlvbiBlcnJvciAtICcgKyBKU09OLnN0cmluZ2lmeShlcnIpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGlzLnVybCA9IHVybDtcblx0XHRcdFx0XHRcdC8vIENoZWNrIGZvciBhbmRyb2lkIHZlcnNpb24gNC4xIGJ1Z1xuXHRcdFx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHRcdFx0dmFyIHhtbEh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTtcblx0XHRcdFx0XHRcdFx0eG1sSHR0cC5vcGVuKCdHRVQnLCB0aGlzLnVybCwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHR4bWxIdHRwLnNlbmQobnVsbCk7XG5cdFx0XHRcdFx0XHR9IGNhdGNoKGVycikge1xuXHRcdFx0XHRcdFx0XHR0aHJvdyAnQW5kcm9pZCB2ZXJzaW9uIDQuMSBlcnJvciAtICcgKyBKU09OLnN0cmluZ2lmeShlcnIpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0Ly8gQ3JlYXRlIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0XHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdFx0XHRcdHVybDogdGhpcy51cmwgKyAnLycgKyB0aGlzLmRibmFtZSxcblx0XHRcdFx0XHRcdFx0dHlwZTogJ1BVVCcsXG5cdFx0XHRcdFx0XHRcdGRhdGE6ICcnLFxuXHRcdFx0XHRcdFx0XHRkYXRhVHlwZTogJ0pTT04nLFxuXHRcdFx0XHRcdFx0XHRjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nXG5cdFx0XHRcdFx0XHR9O1xuXHRcdFx0XHRcdFx0dmFyIGpxeGhyID0gJC5hamF4KG9wdGlvbnMpO1xuXHRcdFx0XHRcdFx0anF4aHIuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUikge1xuXHRcdFx0XHRcdFx0XHRjb25zb2xlLmxvZyhqcVhIUi5yZXNwb25zZVRleHQpO1xuXHRcdFx0XHRcdFx0fSkuZmFpbChmdW5jdGlvbihqcVhIUiwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pIHtcblx0XHRcdFx0XHRcdFx0Y29uc29sZS5sb2coanFYSFIucmVzcG9uc2VUZXh0KTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBTZXQgdGhlIGFkYXB0ZXIgdHlwZVxuXHRcdFx0XHR0aGlzLmFkYXB0ZXIgPSAncG91Y2hkYic7XG5cdFx0XHRcdC8vIENyZWF0ZSB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0XHRjb25zb2xlLndhcm4oJ0NvdWNoYmFzZSBMaXRlIHBsdWdpbiBub3QgZm91bmQuIENyZWF0aW5nIHRoZSBQb3VjaERCIGRhdGFiYXNlLicpO1xuXHRcdFx0XHRpZiAodGhpcy5tb2NrID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0dGhpcy5kYiA9IG5ldyBQb3VjaERCKHRoaXMuZGJuYW1lLCB7IGFkYXB0ZXI6ICdtZW1vcnknIH0pO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoaXMuZGIgPSBuZXcgUG91Y2hEQih0aGlzLmRibmFtZSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gU2VydmVyIFNpZGVcblx0XHRcdHRoaXMuYWRhcHRlciA9ICdjb3VjaGRiJztcblx0XHRcdHRoaXMuZGIgPSBuZXcgUG91Y2hEQignaHR0cDovL2xvY2FsaG9zdDo1OTg0LycgKyB0aGlzLmRibmFtZSk7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIENyZWF0ZSB0aGUgZGF0YWJhc2Vcblx0aWYgKGRibmFtZSA9PT0gdW5kZWZpbmVkKXtcblx0XHR0aHJvdyAnREJFUlJPUjogQSBkYXRhYmFzZSBuYW1lIGlzIHJlcXVpcmVkIGkuZS4gdmFyIGRiID0gbmV3IERhdGFiYXNlKFxcJ2RlZmF1bHRcXCcpOyc7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5jcmVhdGVEQigpO1xuXHR9XG59XG5cbi8qKlxuICogRGVsZXRlIHRoZSBkYXRhYmFzZSBpbmNsdWRpbmcgYWxsIGRvY3VtZW50cyBhbmQgYXR0YWNobWVudHMuIE5vdGUgdGhhdCB0aGlzIGhhcyBubyBpbXBhY3RcbiAqIG9uIG90aGVyIHJlcGxpY2F0ZWQgZGF0YWJhc2VzLlxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBDYWxsIHRoZSBkZWxldGUgZGF0YWJhc2UgZnVuY3Rpb25cbiAqIGRhby5kZWxldGVEQigpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sIGZ1bmN0aW9uKGVycm9yKXtcbiAqICBjb25zb2xlLmxvZyhlcnJvcik7XG4gKiB9KTtcbiAqIC8vIEV4YW1wbGUgcmV0dXJuXG4gKiB7IFwib2tcIjogdHJ1ZSB9XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBSZXR1cm5zIHRoZSBzdGFuZGFyZCB7IFwib2tcIiA6IHRydWUgfSBtZXNzYWdlIG9iamVjdC5cbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5kZWxldGVEQiA9IGZ1bmN0aW9uKCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gRGVsZXRlIHRoZSBkYXRhYmFzZSBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lLFxuXHQgICAgICAgICAgICB0eXBlOiAnREVMRVRFJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTmF0aXZlIC0gZXJyb3IgZGVsZXRpbmcgZGF0YWJhc2UuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIERlbGV0ZSB0aGUgUG91Y2hEQiBkYXRhYmFzZVxuXHRcdFx0c2VsZi5kYi5kZXN0cm95KCkudGhlbihmdW5jdGlvbiAoZGF0YSkge1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24gKGVycikge1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQnJvd3NlciAtIGVycm9yIGRlbGV0aW5nIGRhdGFiYXNlLiBFcnJvciBzdGFja3RyYWNlOiAnICsgZXJyKTtcblx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHR9KTtcblx0XHR9XG5cdH0pO1xufTtcblxuLyoqXG4gKiBDcmVhdGUgYSBuZXcgZG9jdW1lbnQgb3IgdXBkYXRlIGFuIGV4aXN0aW5nIGRvY3VtZW50LiBJZiB0aGUgZG9jdW1lbnQgYWxyZWFkeSBleGlzdHMsXG4gKiB5b3UgbXVzdCBzcGVjaWZ5IGl0cyByZXZpc2lvbiBfcmV2LCBvdGhlcndpc2UgYSBjb25mbGljdCB3aWxsIG9jY3VyLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBkb2MgLSBUaGUgSlNPTiBkb2N1bWVudFxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUZXN0IGRvY3VtZW50XG4gKiB2YXIgZG9jID0geyBcIl9pZFwiOiBcIjEyMzQ1XCIsIFwidGl0bGVcIjogXCJUZXN0IGRvY3VtZW50LlwiIH07XG4gKiBkYW8uc2F2ZShkb2MpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgXCJva1wiOiB0cnVlLCBcImlkXCI6IFwiMTIzNDVcIiwgXCJyZXZcIjogXCIxLUE2MTU3QTVFQTU0NUM5OUIwMEZGOTA0RUVGMDVGRDlGXCIgfVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3BvbnNlIGNvbnRhaW5zIHRoZSBpZCBvZiB0aGUgZG9jdW1lbnQsIHRoZSBuZXcgcmV2LCBhbmQgYW4gb2tcbiAqIHRvIHJlYXNzdXJlIHlvdSB0aGF0IGV2ZXJ5dGhpbmcgaXMgb2theS5cbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5zYXZlID0gZnVuY3Rpb24oZG9jKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBHZXQgdGhlIGRvY3VtZW50IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIFNhdmUgdGhlIGRvY3VtZW50IGluIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvJyArIGRvYy5faWQgKyAnP3Jldj0nICsgZG9jLl9yZXYsXG5cdCAgICAgICAgICAgIHR5cGU6ICdQVVQnLFxuXHQgICAgICAgICAgICBkYXRhOiBKU09OLnN0cmluZ2lmeShkb2MpLFxuXHQgICAgICAgICAgICBjb250ZW50VHlwZTogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHQgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdOYXRpdmUgLSBlcnJvciBzYXZpbmcgZG9jdW1lbnQgd2l0aCBpZDogJyArIGRvYy5faWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBDcmVhdGUgLyB1cGRhdGUgdGhlIGRvY3VtZW50IGluIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLmRiLnB1dChkb2MpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQnJvd3NlciAtIGVycm9yIHNhdmluZyBkb2N1bWVudCB3aXRoIGlkOiAnICsgZG9jLl9pZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBlcnIpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFJldHJpZXZlcyBhIGRvY3VtZW50LCBzcGVjaWZpZWQgYnkgZG9jdW1lbnQgaWQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGlkIC0gRG9jdW1lbnQgdXVpZCAoIGtleSApXG4gKlxuICogQGV4YW1wbGVcbiAqIC8vIENhbGxpbmcgdGhlIGdldCBtZXRob2RcbiAqIGRhby5nZXQoJzEyMzQnKS50aGVuKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAqICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gKiB9LGZ1bmN0aW9uKGVycm9yKXtcbiAqICBjb25zb2xlLmxvZyhlcnJvcik7XG4gKiB9KTtcbiAqIC8vIEV4YW1wbGUgcmV0dXJuXG4gKiB7IFwiX2lkXCI6IFwiMTIzNDVcIiwgXCJfcmV2XCI6IFwiMS1BNjE1N0E1RUE1NDVDOTlCMDBGRjkwNEVFRjA1RkQ5RlwiLCBcInRpdGxlXCI6IFwiVGVzdCBkb2N1bWVudC5cIiB9XG4gKlxuICogQHJldHVybiB7T2JqZWN0fSBUaGUgcmVzcG9uc2UgY29udGFpbnMgdGhlIGRvY3VtZW50IGFzIGl0IGlzIHN0b3JlZCBpbiB0aGUgZGF0YWJhc2UsIGFsb25nXG4gKiB3aXRoIGl0cyBfaWQgYW5kIF9yZXYuXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24oaWQpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEdldCB0aGUgZG9jdW1lbnQgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gR2V0IHRoZSBkb2N1bWVudCBmcm9tIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvJyArIGlkLFxuXHQgICAgICAgICAgICB0eXBlOiAnR0VUJyxcblx0ICAgICAgICAgICAgZGF0YVR5cGU6ICdqc29uJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTmF0aXZlIC0gZXJyb3IgZ2V0dGluZyBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBHZXQgdGhlIGRvY3VtZW50IGZyb20gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIuZ2V0KGlkKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS5sb2coJ0Jyb3dzZXIgLSBlcnJvciBnZXR0aW5nIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBlcnIpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIERlbGV0ZXMgdGhlIGRvY3VtZW50LiBUaGUgaWQgYW5kIHJldiBwYXJhbWV0ZXJzIGFyZSBib3RoIHJlcXVpcmVkLiBXaGVuIGEgZG9jdW1lbnQgaXMgZGVsZXRlZCxcbiAqIHRoZSByZXZpc2lvbiBudW1iZXIgaXMgdXBkYXRlZCBzbyB0aGUgZGF0YWJhc2UgY2FuIHRyYWNrIHRoZSBkZWxldGlvbiBpbiBzeW5jaHJvbml6ZWQgY29waWVzLlxuICpcbiAqIEBwYXJhbSB7T2JqZWN0fSBpZCAtIERvY3VtZW50IHV1aWQgKCBrZXkgKVxuICogQHBhcmFtIHtPYmplY3R9IHJldiAtIERvY3VtZW50IHJldmlzaW9uIG51bWJlclxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUZXN0IGlkIGFuZCByZXYgdmFyaWFibGVzXG4gKiB2YXIgaWQgPSBcIjEyMzQ1XCI7XG4gKiB2YXIgcmV2ID0gXCIxLUE2MTU3QTVFQTU0NUM5OUIwMEZGOTA0RUVGMDVGRDlGXCI7XG4gKiBkYW8ucmVtb3ZlKGlkLCByZXYpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgXCJva1wiOiB0cnVlLCBcImlkXCI6IFwiMTIzNDVcIiwgXCJyZXZcIjogXCIxLUE2MTU3QTVFQTU0NUM5OUIwMEZGOTA0RUVGMDVGRDlGXCIgfVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3BvbnNlIGlzIGEgSlNPTiBkb2N1bWVudCB0aGF0IGNvbnRhaW5zIHRoZSBvaywgaWQgYW5kIHJldiBwcm9wZXJ0aWVzLlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLnJlbW92ZSA9IGZ1bmN0aW9uKGlkLCByZXYpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIERlbGV0ZSB0aGUgZG9jdW1lbnQgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gRGVsZXRlIHRoZSBkb2N1bWVudCBmcm9tIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvJyArIGlkICsgJz9yZXY9JyArIHJldixcblx0ICAgICAgICAgICAgdHlwZTogJ0RFTEVURScsXG5cdCAgICAgICAgICAgIEFjY2VwdDogJ2FwcGxpY2F0aW9uL2pzb24nLFxuXHQgICAgICAgICAgICBkYXRhVHlwZTogJ2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUubG9nKCdOYXRpdmUgLSBlcnJvciBkZWxldGluZyBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBHZXQgdGhlIGRvY3VtZW50IGZyb20gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIucmVtb3ZlKGlkLCByZXYpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQnJvd3NlciAtIGVycm9yIGRlbGV0aW5nIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBlcnIpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIEF0dGFjaGVzIGEgYmluYXJ5IG9iamVjdCB0byBhIGRvY3VtZW50LiBUaGlzIG1ldGhvZCB3aWxsIHVwZGF0ZSBhbiBleGlzdGluZyBkb2N1bWVudCB0byBhZGRcbiAqIHRoZSBhdHRhY2htZW50LCBzbyBpdCByZXF1aXJlcyBhIHJldiBpZiB0aGUgZG9jdW1lbnQgYWxyZWFkeSBleGlzdHMuIElmIHRoZSBkb2N1bWVudCBkb2VzbuKAmXRcbiAqIGFscmVhZHkgZXhpc3QsIHRoZW4gdGhpcyBtZXRob2Qgd2lsbCBjcmVhdGUgYW4gZW1wdHkgZG9jdW1lbnQgY29udGFpbmluZyB0aGUgYXR0YWNobWVudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBEb2N1bWVudCB1dWlkICgga2V5IClcbiAqIEBwYXJhbSB7c3RyaW5nfSByZXYgLSBEb2N1bWVudCByZXZpc2lvbiBudW1iZXJcbiAqIEBwYXJhbSB7YmluYXJ5fSBhdHRhY2hlbW50IC0gQXR0YWNobWVudCBkaW5hcnkgZG9jdW1lbnRcbiAqIEBwYXJhbSB7c3RyaW5nfSB0eXBlIC0gVGhlIGF0dGFjaG1lbnQgbWltZSB0eXBlXG4gKiBAcGFyYW0ge3N0cmluZ30gYXR0YWNoZW1udElkIC0gQXR0YWNobWVudCBpZCBpLmUuIG5hbWUgb2YgdGhlIGZpbGVcbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGVzdCB2YXJpYWJsZXNcbiAqIHZhciBpZCA9IFwiMTIzNDVcIjtcbiAqIHZhciByZXYgPSBcIjEtQTYxNTdBNUVBNTQ1Qzk5QjAwRkY5MDRFRUYwNUZEOUZcIjtcbiAqIHZhciBhdHRhY2htZW50SWQgPSAnZmlsZS50eHQnO1xuICogdmFyIHR5cGUgPSAndGV4dC9wbGFpbic7XG4gKiB2YXIgYXR0YWNobWVudCA9IG5ldyBCbG9iKFsnVGhpcyBpcyBhIHBsYWluIHRleHQgYXR0YWNoZW1lbnQuJ10sIHt0eXBlOiB0eXBlfSk7XG4gKiAvLyBDYWxsIHRoZSBzYXZlQXR0YWNobWVudCBtZXRob2RcbiAqIGRhby5zYXZlQXR0YWNobWVudChpZCwgcmV2LCBhdHRhY2htZW50LCB0eXBlLCBhdHRhY2htZW50SWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgXCJva1wiOiB0cnVlLCBcImlkXCI6IFwiMTIzNDVcIiwgXCJyZXZcIjogXCIyLTA2OEU3M0Y1QjQ0RkVDOTg3QjUxMzU0REZDNzcyODkxXCIgfVxuICpcbiAqIEByZXR1cm4ge09iamVjdH0gVGhlIHJlc3BvbnNlIGNvbnRhaW5zIHRoZSBpZCBvZiB0aGUgZG9jdW1lbnQsIHRoZSBuZXcgcmV2LCBhbmQgYW4gb2sgdG9cbiAqIHJlYXNzdXJlIHlvdSB0aGF0IGV2ZXJ5dGhpbmcgaXMgb2theS5cbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5zYXZlQXR0YWNobWVudCA9IGZ1bmN0aW9uKGlkLCByZXYsIGF0dGFjaGVtbnQsIHR5cGUsIGF0dGFjaGVtbnRJZCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gU2F2ZSB0aGUgYXR0YWNobWVudCB3aXRoIHRoZSBkb2N1bWVudCBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBTYXZlIHRoZSBhdHRhY2htZW50IHdpdGggdGhlIGRvY3VtZW50IGZyb20gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy8nICsgaWQgKyAgJy8nICsgYXR0YWNoZW1udElkICsgJz9yZXY9JyArIHJldixcblx0XHRcdFx0dHlwZTogJ1BVVCcsXG5cdFx0XHRcdGRhdGE6ICBhdHRhY2hlbW50LFxuXHRcdFx0XHRkYXRhVHlwZTogJ2pzb24nLFxuXHRcdFx0XHRjb250ZW50VHlwZTogdHlwZVxuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnTmF0aXZlIC0gZXJyb3Igc2F2aW5nIGF0dGFjaG1lbnQgZm9yIHRoZSBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBTYXZlIHRoZSBhdHRhY2htZW50IHdpdGggdGhlIGRvY3VtZW50IGZyb20gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZGIucHV0QXR0YWNobWVudChpZCwgYXR0YWNoZW1udElkLCByZXYsIGF0dGFjaGVtbnQsIHR5cGUpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLmxvZygnQnJvd3NlciAtIGVycm9yIHNhdmluZyBhdHRhY2htZW50IGZvciB0aGUgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogR2V0IHRoZSBhdHRhY2htZW50IGRhdGEgZnJvbSBhIHNwZWNpZmljIGRvY3VtZW50LlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBpZCAtIERvY3VtZW50IHV1aWQgKCBrZXkgKVxuICogQHBhcmFtIHtzdHJpbmd9IHJldiAtIERvY3VtZW50IHJldmlzaW9uIG51bWJlclxuICogQHBhcmFtIHtzdHJpbmd9IGF0dGFjaGVtbnRJZCAtIEF0dGFjaG1lbnQgaWQgaS5lLiBuYW1lIG9mIHRoZSBmaWxlXG4gKlxuICogQHRvZG8gTmVlZCB0byB1cGRhdGUgdGhlIHdheSBCbG9icyBhcmUgbWFuYWdlZC5cbiAqXG4gKiBAZXhhbXBsZVxuICogLy8gVGVzdCB2YXJpYWJsZXNcbiAqIHZhciBpZCA9IFwiMTIzNDVcIjtcbiAqIHZhciByZXYgPSBcIjEtQTYxNTdBNUVBNTQ1Qzk5QjAwRkY5MDRFRUYwNUZEOUZcIjtcbiAqIHZhciBhdHRhY2htZW50SWQgPSAnZmlsZS50eHQnO1xuICogLy8gQ2FsbCB0aGUgc2F2ZUF0dGFjaG1lbnQgbWV0aG9kXG4gKiBkYW8uZ2V0QXR0YWNobWVudChpZCwgcmV2LCBhdHRhY2htZW50SWQpLnRoZW4oZnVuY3Rpb24ocmVzcG9uc2Upe1xuICogIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAqIH0sZnVuY3Rpb24oZXJyb3Ipe1xuICogIGNvbnNvbGUubG9nKGVycm9yKTtcbiAqIH0pO1xuICogLy8gRXhhbXBsZSByZXR1cm5cbiAqIHsgc2l6ZTogMzMsIHR5cGU6ICd0ZXh0L3BsYWluJyB9XG4gKlxuICogQHJldHVybiB7QmxvYnxDb250ZW50LVR5cGV9IFRoZSByZXNwb25zZSB3aWxsIGJlIGEgQmxvYiBvYmplY3QgaW4gdGhlIGJyb3dzZXIgb3IgaW4gdGhlIGZvcm1hdFxuICogc3BlY2lmaWVkIGluIHRoZSBDb250ZW50LVR5cGUgaGVhZGVyLlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmdldEF0dGFjaG1lbnQgPSBmdW5jdGlvbihpZCwgcmV2LCBhdHRhY2hlbW50SWQpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIEdldCB0aGUgYXR0YWNobWVudCBmcm9tIHRoZSBkb2N1bWVudCBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBHZXQgdGhlIGF0dGFjaG1lbnQgZnJvbSB0aGUgZG9jdW1lbnQgZnJvbSB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnLycgKyBpZCArICAnLycgKyBhdHRhY2hlbW50SWQgKyAnP3Jldj0nICsgcmV2LFxuXHRcdFx0XHR0eXBlOiAnR0VUJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ05hdGl2ZSAtIGVycm9yIHJldHJpZXZpbmcgYXR0YWNobWVudCBmb3IgdGhlIGRvY3VtZW50IHdpdGggaWQ6ICcgKyBpZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgYXR0YWNobWVudCBmcm9tIHRoZSBkb2N1bWVudCBmcm9tIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLmRiLmdldEF0dGFjaG1lbnQoaWQsIGF0dGFjaGVtbnRJZCwgeyByZXY6IHJldiB9KS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdCcm93c2VyIC0gZXJyb3IgcmV0cmlldmluZyBhdHRhY2htZW50IGZvciB0aGUgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogRGVsZXRlIGFuIGF0dGFjaG1lbnQgZnJvbSBhIGRvYy4gWW91IG11c3Qgc3VwcGx5IHRoZSByZXYgb2YgdGhlIGV4aXN0aW5nIGRvYy5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBEb2N1bWVudCB1dWlkICgga2V5IClcbiAqIEBwYXJhbSB7c3RyaW5nfSByZXYgLSBEb2N1bWVudCByZXZpc2lvbiBudW1iZXJcbiAqIEBwYXJhbSB7c3RyaW5nfSBhdHRhY2hlbW50SWQgLSBBdHRhY2htZW50IGlkIGkuZS4gbmFtZSBvZiB0aGUgZmlsZVxuICpcbiAqIEBleGFtcGxlXG4gKiAvLyBUZXN0IHZhcmlhYmxlc1xuICogdmFyIGlkID0gXCIxMjM0NVwiO1xuICogdmFyIHJldiA9IFwiMS1BNjE1N0E1RUE1NDVDOTlCMDBGRjkwNEVFRjA1RkQ5RlwiO1xuICogdmFyIGF0dGFjaG1lbnRJZCA9ICdmaWxlLnR4dCc7XG4gKiAvLyBDYWxsIHRoZSBzYXZlQXR0YWNobWVudCBtZXRob2RcbiAqIGRhby5kZWxldGVBdHRhY2htZW50KGlkLCByZXYsIGF0dGFjaG1lbnRJZCkudGhlbihmdW5jdGlvbihyZXNwb25zZSl7XG4gKiAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICogfSxmdW5jdGlvbihlcnJvcil7XG4gKiAgY29uc29sZS5sb2coZXJyb3IpO1xuICogfSk7XG4gKiAvLyBFeGFtcGxlIHJldHVyblxuICogeyBcIm9rXCI6IHRydWUsIFwicmV2XCI6IFwiMi0xRjk4MzIxMUFCODdFRkNDQzk4MDk3NERGQzI3MzgyRlwiIH1cbiAqXG4gKiBAcmV0dXJuIHtPYmplY3R9IFRoZSByZXNwb25zZSBjb250YWlucyB0aGUgdGhlIG5ldyByZXYsIGFuZCBhbiBvayB0byByZWFzc3VyZSB5b3UgdGhhdFxuICogZXZlcnl0aGluZyBpcyBva2F5LlxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmRlbGV0ZUF0dGFjaG1lbnQgPSBmdW5jdGlvbihpZCwgcmV2LCBhdHRhY2hlbW50SWQpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIERlbGV0ZSB0aGUgYXR0YWNobWVudCBmcm9tIHRoZSBkb2N1bWVudCBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIGF0dGFjaG1lbnQgZnJvbSB0aGUgZG9jdW1lbnQgaW4gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy8nICsgaWQgKyAgJy8nICsgYXR0YWNoZW1udElkICsgJz9yZXY9JyArIHJldixcblx0XHRcdFx0dHlwZTogJ0RFTEVURScsXG5cdFx0XHRcdGRhdGFUeXBlOiAnanNvbidcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdOYXRpdmUgLSBlcnJvciBkZWxldGluZyBhdHRhY2htZW50IGZvciB0aGUgZG9jdW1lbnQgd2l0aCBpZDogJyArIGlkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gRGVsZXRlIHRoZSBhdHRhY2htZW50IGZyb20gdGhlIGRvY3VtZW50IGluIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLmRiLnJlbW92ZUF0dGFjaG1lbnQoaWQsIGF0dGFjaGVtbnRJZCwgcmV2KS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuY2F0Y2goZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdFUlJDT0RFOiAnICsgZXJyLnN0YXR1cyArICcgKCAnICsgZXJyLm5hbWUgKyAnICkgJyArICctIEVycm9yIGRlbGV0aW5nIGF0dGFjaG1lbnQgZm9yIHRoZSBkb2N1bWVudCB3aXRoIGlkOiAnICsgaWQgKyAnLiAnICsgZXJyLm1lc3NhZ2UgKyAnLicpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFRoaXMgbWV0aG9kIGNyZWF0ZXMgb3IgdXBkYXRlcyBhIGRlc2lnbiBkb2N1bWVudC5cbiAqXG4gKiBAcGFyYW0ge3N0cmluZ30gZG9jSWQgLSBEZXNpZ24gZG9jdW1lbnQgaWRcbiAqIEBwYXJhbSB7c3RyaW5nfSB2aWV3SWQgLSBEZXNpZ24gZG9jdW1lbnQgdmlldyBpZFxuICogQHBhcmFtIHtzdHJpbmd9IGZ1bmMgLSBEZXNpZ24gZG9jdW1lbnQgdmlldyBsb2dpYywgc2hvdWxkIGJlIGEgSmF2YXNjcmlwdCBzdHJpbmdcbiAqXG4gKiBAZXhhbXBsZVxuICogdmFyIGRhbyA9IG5ldyBEYXRhYmFzZSh7IGRibmFtZTogJ2RlZmF1bHQnIH0pO1xuICpcbiAqXG4gKiBAcmV0dXJuIEpTT04gc3RhbmRhcmQgcmVzcG9uc2VcbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5jcmVhdGVEb2NWaWV3ID0gZnVuY3Rpb24oZG9jSWQsIHZpZXdJZCwganNGdW5jdGlvbil7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gQ3JlYXRlIHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBDcmVhdGUgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGluIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIGRkb2MgPSB7XG5cdFx0XHRcdCdsYW5ndWFnZScgOiAnamF2YXNjcmlwdCcsXG5cdFx0XHRcdCd2aWV3cycgOiB7fVxuXHRcdFx0fTtcblx0XHRcdHZhciBmdW5jID0gJ2Z1bmN0aW9uKGRvYykgeyAnICsganNGdW5jdGlvbi50b1N0cmluZygpICsgJyB9Jztcblx0XHRcdGRkb2Mudmlld3Nbdmlld0lkXSA9IHsgJ21hcCc6IGZ1bmMgfTtcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnL19kZXNpZ24vJyArIGRvY0lkLFxuXHRcdFx0XHR0eXBlOiAnUFVUJyxcblx0XHRcdFx0ZGF0YTogZGRvYyxcblx0XHRcdFx0ZGF0YVR5cGU6ICdqc29uJyxcblx0XHRcdFx0Y29udGVudFR5cGU6ICdhcHBsaWNhdGlvbi9qc29uJ1xuXHRcdFx0fTtcblx0XHRcdCQuYWpheChvcHRpb25zKS5kb25lKGZ1bmN0aW9uKGRhdGEsIHRleHRTdGF0dXMsIHhocil7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5mYWlsKGZ1bmN0aW9uKHhociwgdGV4dFN0YXR1cywgZXJyb3JUaHJvd24pe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ05hdGl2ZSAtIGVycm9yIGNyZWF0aW5nIHRoZSBkZXNpZ24gZG9jdW1lbnQgd2l0aCB0aGUgaWQ6ICcgKyBkb2NJZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIENyZWF0ZSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHZhciBkZG9jID0ge1xuXHRcdFx0XHQnX2lkJyA6ICdfZGVzaWduLycgKyBkb2NJZCxcblx0XHRcdFx0J3ZpZXdzJyA6IHt9XG5cdFx0XHR9O1xuXHRcdFx0dmFyIGZ1bmMgPSAnZnVuY3Rpb24oZG9jKSB7ICcgKyBqc0Z1bmN0aW9uLnRvU3RyaW5nKCkgKyAnIH0nO1xuXHRcdFx0ZGRvYy52aWV3c1t2aWV3SWRdID0geyAnbWFwJzogZnVuYyB9O1xuXHRcdFx0c2VsZi5zYXZlKGRkb2MpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRpZiAoZXJyLnN0YXR1cyAhPT0gNDA5KSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKCdCcm93c2VyIC0gZXJyb3IgY3JlYXRpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Y29uc29sZS53YXJuKGVycik7XG5cdFx0XHRcdFx0cmVzb2x2ZSh7fSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIFRoaXMgcmVxdWVzdCByZXRyaWV2ZXMgYSBkZXNpZ24gZG9jdW1lbnQuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGRvY0lkIC0gRGVzaWduIGRvY3VtZW50IGlkXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuZ2V0RG9jVmlldyA9IGZ1bmN0aW9uKGRvY0lkKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBHZXQgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIEdldCB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHtcblx0XHRcdFx0dXJsOiBzZWxmLnVybCArICcvJyArIHNlbGYuZGJuYW1lICsgJy9fZGVzaWduLycgKyBkb2NJZCxcblx0XHRcdFx0dHlwZTogJ0dFVCdcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdOYXRpdmUgLSBlcnJvciBnZXR0aW5nIHRoZSBkZXNpZ24gZG9jdW1lbnQgd2l0aCB0aGUgaWQ6ICcgKyBkb2NJZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgaW4gdGhlIFBvdWNoREIgZGF0YWJhc2Vcblx0XHRcdHNlbGYuZ2V0KCdfZGVzaWduLycgKyBkb2NJZCkudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignQnJvd3NlciAtIGVycm9yIGdldHRpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIGVycik7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogVGhpcyByZXF1ZXN0IGRlbGV0ZXMgdGhlIGRlc2lnbiBkb2N1bWVudCBmcm9tIHRoZSBzcGVjaWZpZWQgZGF0YWJhc2UuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGRvY0lkIC0gRGVzaWduIGRvY3VtZW50IGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gcmV2IC0gRGVzaWduIGRvY3VtZW50IHJldmlzaW9uIGlkXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUuZGVsZXRlRG9jVmlldyA9IGZ1bmN0aW9uKGRvY0lkLCByZXYpe1xuXHR2YXIgc2VsZiA9IHRoaXM7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIERlbGV0ZSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gRGVsZXRlIHRoZSBkZWlzZ24gZG9jdW1lbnQgdmlldyBpbiB0aGUgQ291Y2hiYXNlIExpdGUgZGF0YWJhc2Vcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnL19kZXNpZ24vJyArIGRvY0lkICsgJz9yZXY9JyArIHJldixcblx0XHRcdFx0dHlwZTogJ0RFTEVURSdcblx0XHRcdH07XG5cdFx0XHQkLmFqYXgob3B0aW9ucykuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCB4aHIpe1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSkuZmFpbChmdW5jdGlvbih4aHIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKXtcblx0XHRcdFx0Y29uc29sZS53YXJuKCdOYXRpdmUgLSBlcnJvciBkZWxldGluZyB0aGUgZGVzaWduIGRvY3VtZW50IHdpdGggdGhlIGlkOiAnICsgZG9jSWQgKyAnLiBFcnJvciBzdGFja3RyYWNlOiAnICsgSlNPTi5zdHJpbmdpZnkoeGhyKSk7XG5cdFx0XHRcdHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTtcblx0XHRcdH0pO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBEZWxldGUgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGluIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLnJlbW92ZSgnX2Rlc2lnbi8nICsgZG9jSWQsIHJldikudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignQnJvd3NlciAtIGVycm9yIGRlbGV0aW5nIHRoZSBkZXNpZ24gZG9jdW1lbnQgd2l0aCB0aGUgaWQ6ICcgKyBkb2NJZCArICcuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBlcnIpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIEludm9rZSBhIG1hcC9yZWR1Y2UgZnVuY3Rpb24sIHdoaWNoIGFsbG93cyB5b3UgdG8gcGVyZm9ybSBtb3JlIGNvbXBsZXggcXVlcmllcyBvbiBQb3VjaERCXG4gKiBvciBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZXMuXG4gKlxuICogQHBhcmFtIHtzdHJpbmd9IGRvY0lkIC0gRGVzaWduIGRvY3VtZW50IGlkXG4gKiBAcGFyYW0ge3N0cmluZ30gdmlld0lkIC0gRGVzaWduIGRvY3VtZW50IHZpZXcgaWRcbiAqIEBwYXJhbSB7T2JqZWN0fSBvcHRzIC0gTWFwIHJlZHVjZSBvcHRpb25zXG4gKlxuICogQGV4YW1wbGVcbiAqIHZhciBkYW8gPSBuZXcgRGF0YWJhc2UoeyBkYm5hbWU6ICdkZWZhdWx0JyB9KTtcbiAqXG4gKiBAdG9kbyBBZGQgYWxsIHRoZSBvcHRpb25hbCBxdWVyeSBvcHRpb25zXG4gKlxuICogQHJldHVybiBKU09OIHN0YW5kYXJkIHJlc3BvbnNlXG4gKlxuICovXG5EYXRhYmFzZS5wcm90b3R5cGUucXVlcnkgPSBmdW5jdGlvbihkb2NJZCwgdmlld0lkLCBvcHRzKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBRdWVyeSB0aGUgZGVpc2duIGRvY3VtZW50IHZpZXcgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gUXVlcnkgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGluIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0dmFyIHBhcmFtcyA9ICdpbmNsdWRlX2RvY3M9dHJ1ZSZrZXk9JyArIG9wdHMua2V5O1xuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdHVybDogc2VsZi51cmwgKyAnLycgKyBzZWxmLmRibmFtZSArICcvX2Rlc2lnbi8nICsgZG9jSWQgKyAnL192aWV3LycgKyB2aWV3SWQgKyAnPycgKyBwYXJhbXMsXG5cdFx0XHRcdHR5cGU6ICdHRVQnLFxuXHRcdFx0XHRkYXRhVHlwZTogJ2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTmF0aXZlIC0gZXJyb3IgcXVlcnlpbmcgdGhlIGRlc2lnbiBkb2N1bWVudCB3aXRoIHRoZSBpZDogJyArIGRvY0lkICsgJy4gRXJyb3Igc3RhY2t0cmFjZTogJyArIEpTT04uc3RyaW5naWZ5KHhocikpO1xuXHRcdFx0XHRyZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7XG5cdFx0XHR9KTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gUXVlcnkgdGhlIGRlaXNnbiBkb2N1bWVudCB2aWV3IGluIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHR2YXIgcGFnZVNpemUgPSBvcHRzLnBhZ2VTaXplIHx8IDEwMDtcblx0XHRcdHZhciBwYWdlSW5kZXggPSBvcHRzLnBhZ2VJbmRleCB8fCAwO1xuXHRcdFx0dmFyIG9wdGlvbnMgPSB7XG5cdFx0XHRcdGtleTogb3B0cy5rZXksXG5cdFx0XHRcdGxpbWl0OiBwYWdlU2l6ZSxcblx0XHRcdFx0c2tpcDogcGFnZUluZGV4ICogcGFnZVNpemUsXG4gICAgXHRcdFx0aW5jbHVkZV9kb2NzOiB0cnVlXG5cdFx0XHR9O1xuXHRcdFx0c2VsZi5kYi5xdWVyeShkb2NJZCArICcvJyArIHZpZXdJZCwgb3B0aW9ucykudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmNhdGNoKGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignRVJSQ09ERTogJyArIGVyci5zdGF0dXMgKyAnICggJyArIGVyci5uYW1lICsgJyApICcgKyAnLSBxdWVyeWluZyB0aGUgZGVzaWduIGRvY3VtZW50IHdpdGggdGhlIGlkOiAnICsgaWQgKyAnLiAnICsgZXJyLm1lc3NhZ2UgKyAnLicpO1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0pO1xuXHRcdH1cblx0fSk7XG59O1xuXG4vKipcbiAqIEF1dGhlbnRpY2F0ZSBhIHVzZXIgYWdhaW5zdCB0aGUgQ291Y2hiYXNlIFN5bmMgR2F0ZXdheS5cbiAqXG4gKiBAZXhhbXBsZVxuICogZGFvLmF1dGhlbnRpY2F0ZVRvU3luY0dhdGV3YXkoKTtcbiAqXG4gKiBAcmV0dXJuIEpTT04gc3RhbmRhcmQgcmVzcG9uc2VcbiAqXG4gKi9cbkRhdGFiYXNlLnByb3RvdHlwZS5hdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5ID0gZnVuY3Rpb24oKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHR2YXIgdXJsID0gc2VsZi5zeW5jVVJMICsgJy9fc2Vzc2lvbic7XG5cdFx0dmFyIG1ldGhvZCA9ICdQT1NUJztcblx0XHR2YXIgcG9zdERhdGEgPSBKU09OLnN0cmluZ2lmeSh7XG5cdFx0XHQnbmFtZSc6IHNlbGYudXNlcm5hbWUsICdwYXNzd29yZCc6IHNlbGYucGFzc3dvcmRcblx0XHR9KTtcblx0XHR2YXIgYXN5bmMgPSB0cnVlO1xuXHRcdHZhciByZXF1ZXN0ID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7XG5cdFx0cmVxdWVzdC53aXRoQ3JlZGVudGlhbHMgPSB0cnVlO1xuXHRcdHJlcXVlc3Qub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc3RhdHVzID0gcmVxdWVzdC5zdGF0dXM7XG5cdFx0XHR2YXIgZGF0YSA9IHJlcXVlc3QucmVzcG9uc2VUZXh0O1xuXHRcdFx0aWYoc3RhdHVzID09IDIwMCkge1xuXHRcdFx0XHRzZWxmLmF1dGhlbnRpY2F0ZWQgPSB0cnVlO1xuXHRcdFx0XHRyZXNvbHZlKGRhdGEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmVqZWN0KGRhdGEpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHRyZXF1ZXN0Lm9wZW4obWV0aG9kLCB1cmwsIGFzeW5jKTtcblx0XHRyZXF1ZXN0LnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PVVURi04Jyk7XG5cdFx0cmVxdWVzdC5zZW5kKHBvc3REYXRhKTtcblx0fSk7XG59O1xuXG4vKipcbiAqIFRoaXMgcmVxdWVzdCByZXRyaWV2ZXMgYSBzb3J0ZWQgbGlzdCBvZiBjaGFuZ2VzIG1hZGUgdG8gZG9jdW1lbnRzIGluIHRoZSBkYXRhYmFzZSxcbiAqIGluIHRpbWUgb3JkZXIgb2YgYXBwbGljYXRpb24uXG4gKlxuICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAqIFx0QHBhcmFtIHtzdHJpbmd9IG9wdHMubGltaXRcbiAqXHRUaGUgbWF4IGFtb3VudCBvZiBkb2N1bWVudCBjaGFuZ2VzIHRvIHJldHVyblxuICogXHRAcGFyYW0ge3N0cmluZ30gb3B0cy5zaW5jZVxuICpcdFRoZSBsYXN0IGNoYW5nZSBzZXF1ZW5jZVxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgZGFvID0gbmV3IERhdGFiYXNlKHsgZGJuYW1lOiAnZGVmYXVsdCcgfSk7XG4gKlxuICpcbiAqIEByZXR1cm4gSlNPTiBzdGFuZGFyZCByZXNwb25zZVxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLmNoYW5nZXMgPSBmdW5jdGlvbihvcHRzKXtcblx0dmFyIHNlbGYgPSB0aGlzO1xuXHQvLyBVc2UgdGhlIG5hdGl2ZSBQcm9taXNlIGNvbnN0cnVjdG9yXG5cdHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblx0XHQvLyBHZXQgdGhlIG1vc3QgcmVjZW50bHkgY2hhbmdlZCBkb2N1bWVudHMgYmFzZWQgb24gdGhlIGFkYXB0ZXIgcHJvcGVydHlcblx0XHRpZiAoc2VsZi5hZGFwdGVyID09PSAnY291Y2hiYXNlJykge1xuXHRcdFx0Ly8gR2V0IHRoZSBtb3N0IHJlY2VudGx5IGNoYW5nZWQgZG9jdW1lbnRzIGZyb20gdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlXG5cdFx0XHR2YXIgcGFyYW1zID0gJ2xpbWl0PTEwMCZzaW5jZT0nKyBzZWxmLl9zZXR0aW5ncy5sYXN0U3luY1NlcTtcblx0XHRcdHZhciBvcHRpb25zID0ge1xuXHRcdFx0XHR1cmw6IHNlbGYudXJsICsgJy8nICsgc2VsZi5kYm5hbWUgKyAnL19jaGFuZ2VzPycgKyBwYXJhbXMsXG5cdFx0XHRcdHR5cGU6ICdHRVQnLFxuXHRcdFx0XHRkYXRhVHlwZTogJ2pzb24nXG5cdFx0XHR9O1xuXHRcdFx0JC5hamF4KG9wdGlvbnMpLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywgeGhyKXtcblx0XHRcdFx0cmVzb2x2ZShkYXRhKTtcblx0XHRcdH0pLmZhaWwoZnVuY3Rpb24oeGhyLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bil7XG5cdFx0XHRcdGNvbnNvbGUud2FybignTmF0aXZlIC0gZXJyb3IgcmV0cmlldmluZyB0aGUgbGF0ZXN0IGNoYW5nZXMuIEVycm9yIHN0YWNrdHJhY2U6ICcgKyBKU09OLnN0cmluZ2lmeSh4aHIpKTtcblx0XHRcdFx0cmVqZWN0KHhoci5yZXNwb25zZVRleHQpO1xuXHRcdFx0fSk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdC8vIEdldCB0aGUgbW9zdCByZWNlbnRseSBjaGFuZ2VkIGRvY3VtZW50cyBmcm9tIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHR2YXIgcGFyYW1zID0ge1xuXHRcdFx0XHRsaW1pdDogMTAwLFxuXHRcdFx0XHRzaW5jZTogc2VsZi5fc2V0dGluZ3MubGFzdFN5bmNTZXFcblx0XHRcdH07XG5cdFx0XHR2YXIgb3B0aW9ucyA9IG9wdHMgfHwgcGFyYW1zO1xuXHRcdFx0c2VsZi5kYi5jaGFuZ2VzKG9wdGlvbnMpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ0VSUkNPREU6ICcgKyBlcnIuc3RhdHVzICsgJyAoICcgKyBlcnIubmFtZSArICcgKSAnICsgJy0gcmV0cmlldmluZyB0aGUgbGF0ZXN0IGNoYW5nZXM6ICcgKyBpZCArICcuICcgKyBlcnIubWVzc2FnZSArICcuJyk7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cbi8qKlxuICogUmVwbGljYXRlIGRhdGEgZnJvbSBzb3VyY2UgdG8gdGFyZ2V0LiBCb3RoIHRoZSBzb3VyY2UgYW5kIHRhcmdldCBjYW4gYmUgYSBQb3VjaERCXG4gKiBpbnN0YW5jZSBvciBhIHN0cmluZyByZXByZXNlbnRpbmcgYSBDb3VjaERCLyBDb3VjaGJhc2UgZGF0YWJhc2UgVVJMLlxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgZGFvID0gbmV3IERhdGFiYXNlKHsgZGJuYW1lOiAnZGVmYXVsdCcgfSk7XG4gKlxuICpcbiAqIEByZXR1cm4gSlNPTiBzdGFuZGFyZCByZXNwb25zZVxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLnN0YXJ0UHVsbCA9IGZ1bmN0aW9uKCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0Ly8gVXNlIHRoZSBuYXRpdmUgUHJvbWlzZSBjb25zdHJ1Y3RvclxuXHRyZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cdFx0Ly8gR2V0IHRoZSBkb2N1bWVudHMgZnJvbSB0aGUgc2VydmVyIGJhc2VkIG9uIHRoZSBhZGFwdGVyIHByb3BlcnR5XG5cdFx0aWYgKHNlbGYuYWRhcHRlciA9PT0gJ2NvdWNoYmFzZScpIHtcblx0XHRcdC8vIEdldCB0aGUgZG9jdW1lbnRzIGZyb20gdGhlIHNlcnZlciBmb3IgdGhlIENvdWNoYmFzZSBMaXRlIGRhdGFiYXNlLlxuXHRcdFx0Ly8gVXNlIHRoZSBjb3Jkb3ZhLmV4ZWMgZnVuY3Rpb24gdG8gY2FsbCB0aGUgcHVsbCBhY3Rpb24uXG5cdFx0XHRjb3Jkb3ZhLmV4ZWMoZnVuY3Rpb24oc3VjY2Vzcyl7XG5cdFx0XHRcdHJlc29sdmUoc3VjY2Vzcyk7XG5cdFx0XHR9LCBmdW5jdGlvbihlcnJvcil7XG5cdFx0XHRcdHJlamVjdChlcnJvcik7XG5cdFx0XHR9LFxuXHRcdFx0XHQnQ0JMaXRlJywgJ3B1bGwnLFxuXHRcdFx0XHRbe1xuXHRcdFx0XHRcdCdkYm5hbWUnOiBzZWxmLmRibmFtZSxcblx0XHRcdFx0XHQndXJsJzogc2VsZi5zeW5jVVJMXG5cdFx0XHRcdH1dXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBHZXQgdGhlIGRvY3VtZW50cyBmcm9tIHRoZSBzZXJ2ZXIgZm9yIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRzZWxmLmRiLnJlcGxpY2F0ZS5mcm9tKG5ldyBQb3VjaERCKHNlbGYuc3luY1VSTCkpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG5cdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHR9KS5jYXRjaChmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRjb25zb2xlLndhcm4oJ0VSUkNPREU6ICcgKyBlcnIuc3RhdHVzICsgJyAoICcgKyBlcnIubmFtZSArICcgKSAnICsgJy0gcmV0cmlldmluZyB0aGUgbGF0ZXN0IGNoYW5nZXM6ICcgKyBpZCArICcuICcgKyBlcnIubWVzc2FnZSArICcuJyk7XG5cdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0fSk7XG5cdFx0fVxuXHR9KTtcbn07XG5cblxuLyoqXG4gKiBTeW5jIGRhdGEgZnJvbSBzcmMgdG8gdGFyZ2V0IGFuZCB0YXJnZXQgdG8gc3JjLiBUaGlzIGlzIGEgY29udmVuaWVuY2UgbWV0aG9kIGZvclxuICogYmlkaXJlY3Rpb25hbCBkYXRhIHJlcGxpY2F0aW9uLlxuICpcbiAqIEBwYXJhbSB7c3RyaW5nfSBzb3VyY2UgLSBUaGUgc291cmNlIGRhdGFiYXNlXG4gKiBAcGFyYW0ge3N0cmluZ30gdGFyZ2V0IC0gVGhlIHRhcmdldCBkYXRhYmFzZVxuICpcbiAqIEBleGFtcGxlXG4gKiB2YXIgZGFvID0gbmV3IERhdGFiYXNlKHsgZGJuYW1lOiAnZGVmYXVsdCcgfSk7XG4gKlxuICpcbiAqIEByZXR1cm4gSlNPTiBzdGFuZGFyZCByZXNwb25zZVxuICpcbiAqL1xuRGF0YWJhc2UucHJvdG90eXBlLnN0YXJ0U3luYyA9IGZ1bmN0aW9uKCl7XG5cdHZhciBzZWxmID0gdGhpcztcblx0dmFyIHN5bmNVc2VybmFtZSA9IHNlbGYuX3NldHRpbmdzLnN1YnNjcmlwdGlvbnMudXNlcm5hbWU7XG4gICAgdmFyIHN5bmNQYXNzd29yZCA9IHNlbGYuX3NldHRpbmdzLnN1YnNjcmlwdGlvbnMucGFzc3dvcmQ7XG5cdC8vIFVzZSB0aGUgbmF0aXZlIFByb21pc2UgY29uc3RydWN0b3Jcblx0cmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXHRcdC8vIFN5bmNocm9uaXNlIGFsbCB0aGUgZG9jdW1lbnRzIGZyb20gdGhlIHNlcnZlciBiYXNlZCBvbiB0aGUgYWRhcHRlciBwcm9wZXJ0eVxuXHRcdGlmIChzZWxmLmFkYXB0ZXIgPT09ICdjb3VjaGJhc2UnKSB7XG5cdFx0XHQvLyBTeW5jaHJvbmlzZSBhbGwgdGhlIGRvY3VtZW50cyBmcm9tIHRoZSBzZXJ2ZXIgZm9yIHRoZSBDb3VjaGJhc2UgTGl0ZSBkYXRhYmFzZVxuXHRcdFx0Y29yZG92YS5leGVjKGZ1bmN0aW9uKHNlcSl7XG5cdFx0XHRcdGlmKHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxID09PSBzZXEpe1xuXHRcdFx0XHRcdHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxID0gc2VxO1xuXHRcdFx0XHRcdHNlbGYuc2F2ZShzZWxmLl9zZXR0aW5ncykudGhlbihmdW5jdGlvbihkYXRhKXtcblx0XHRcdFx0XHRcdHJlc29sdmUoZGF0YSk7XG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oZXJyKXtcblx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBmdW5jdGlvbihlcnIpe1xuXHRcdFx0XHRyZWplY3QoZXJyKTtcblx0XHRcdH0sXG5cdFx0XHRcdCdDQkxpdGUnLCAnc3luYycsXG5cdFx0XHRcdFt7XG5cdFx0XHRcdFx0J2RibmFtZSc6IHNlbGYuZGJuYW1lLFxuXHRcdFx0XHRcdCd1cmwnOiAnaHR0cDovLycgKyBzeW5jVXNlcm5hbWUgKyAnOicgKyBzeW5jUGFzc3dvcmQgKyAnQCcgKyBzZWxmLnN5bmNVUkwucmVwbGFjZSgnaHR0cDovLycsJycpXG5cdFx0XHRcdH1dXG5cdFx0XHQpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQvLyBTeW5jaHJvbmlzZSBhbGwgdGhlIGRvY3VtZW50cyBmcm9tIHRoZSBzZXJ2ZXIgZm9yIHRoZSBQb3VjaERCIGRhdGFiYXNlXG5cdFx0XHRpZihzZWxmLmF1dGhlbnRpY2F0ZWQgPT09IGZhbHNlKXtcblx0XHRcdFx0c2VsZi5hdXRoZW50aWNhdGVUb1N5bmNHYXRld2F5KHN5bmNVc2VybmFtZSwgc3luY1Bhc3N3b3JkKS50aGVuKGZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0XHRcdHNlbGYuZGIuc3luYyhuZXcgUG91Y2hEQihzZWxmLnN5bmNVUkwpLCB7IGxpdmU6IHRydWUsIHJldHJ5OiB0cnVlIH0pXG5cdFx0XHRcdFx0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBzZXEgPSBkYXRhLmxhc3Rfc2VxO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2VsZi5fc2V0dGluZ3MubGFzdFN5bmNTZXEgIT09IHNlcSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgXHRzZWxmLl9zZXR0aW5ncy5sYXN0U3luY1NlcSA9IHNlcTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgXHRzZWxmLnNhdmUoc2VsZi5fc2V0dGluZ3MpLnRoZW4oZnVuY3Rpb24oZGF0YSl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgIFx0XHRyZXNvbHZlKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICBcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuICAgICAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgICAgICAub24oJ2Vycm9yJywgZnVuY3Rpb24oZXJyKXtcbiAgICAgICAgICAgICAgICAgICAgXHRyZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG5cdFx0XHRcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0cmVqZWN0KGVycik7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2VsZi5kYi5zeW5jKG5ldyBQb3VjaERCKHNlbGYuc3luY1VSTCksIHsgbGl2ZTogdHJ1ZSwgcmV0cnk6IHRydWUgfSlcblx0XHRcdFx0Lm9uKCdjaGFuZ2UnLCBmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHNlcSA9IGRhdGEubGFzdF9zZXE7XG4gICAgICAgICAgICAgICAgICAgIGlmKHNlbGYuX3NldHRpbmdzLmxhc3RTeW5jU2VxICE9PSBzZXEpe1xuICAgICAgICAgICAgICAgICAgICAgXHRzZWxmLl9zZXR0aW5ncy5sYXN0U3luY1NlcSA9IHNlcTtcbiAgICAgICAgICAgICAgICAgICAgICBcdHNlbGYuc2F2ZShzZWxmLl9zZXR0aW5ncykudGhlbihmdW5jdGlvbihkYXRhKXtcbiAgICAgICAgICAgICAgICAgICAgICBcdFx0cmVzb2x2ZShkYXRhKTtcbiAgICAgICAgICAgICAgICAgICAgICBcdH0sIGZ1bmN0aW9uKGVycil7XG5cdFx0XHRcdFx0XHRcdHJlamVjdChlcnIpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0fVxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycil7XG4gICAgICAgICAgICAgICAgXHRyZWplY3QoZXJyKTtcbiAgICAgICAgICAgICAgICB9KTtcblx0XHRcdH1cblx0XHR9XG5cdH0pO1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBEYXRhYmFzZTtcbiJdfQ==
